if (self.CavalryLogger) { CavalryLogger.start_js(["eJV0h"]); }

__d("MercuryThreadlistContainer.react",["Bootloader","emptyFunction","immutable","MercuryAPIArgsSource","MercuryConfig","MercuryFilters","MercuryIDs","MercuryThreadlistConstants","MessagingTag","P2PJewelBannerContainer.react","React","SubscriptionsHandler","gkx","setImmediate","MessengerStateStore","MessengerMessageRequestsTypedLogger"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h,i,j=c("React").PropTypes,k="search",l=3,m=5e3,n=c("MercuryThreadlistConstants").JEWEL_THREAD_COUNT+l;h=babelHelpers.inherits(o,c("React").Component);i=h&&h.prototype;function o(){__p&&__p();var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=i.constructor).call.apply(p,[this].concat(s)),this.state={aggregatedThreads:null,showAggregation:false,isLoading:true,isSearching:false,unreadMessageRequestThreads:[],threads:c("immutable").Map()},this.threadListReqsInFlight=0,this.$MercuryThreadlistContainer13=function(){__p&&__p();var u=function(){this.setState({suspended:false});this.handleThreadListUpdate()}.bind(this);if(c("MercuryConfig").deferJewelUpdateOnChatOpen&&c("MercuryConfig").deferJewelUpdateOnChatOpen==="setTimeout"){this.setState({suspended:true});setTimeout(u,m)}else if(c("MercuryConfig").deferJewelUpdateOnChatOpen&&c("MercuryConfig").deferJewelUpdateOnChatOpen==="requestIdleCallback"){this.setState({suspended:true});requestIdleCallback(u,{timeout:m})}}.bind(this),this.$MercuryThreadlistContainer14=function(){if(this.props.folder!=="aggregation"&&!this.state.isSearching&&!this.state.isLoading&&!this.$MercuryThreadlistContainer1.hasLoadedThreadlist(this.props.folder,this.props.filter))this.$MercuryThreadlistContainer7(this.props.folder,this.props.filter,this.$MercuryThreadlistContainer8(this.props.folder)+c("MercuryThreadlistConstants").JEWEL_MORE_COUNT+1)}.bind(this),this.$MercuryThreadlistContainer21=function(){if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;var u=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").PENDING,c("MercuryFilters").UNREAD);this.$MercuryThreadlistContainer2.getMultiThreadMeta(u,function(v){this.setState({unreadMessageRequestThreads:u.map(function(w){return v[w]})})}.bind(this))}.bind(this),this.$MercuryThreadlistContainer16=function(u,v){this.setState({isLoading:v,searchThreads:[]},function(){return this.$MercuryThreadlistContainer12(k,c("MercuryFilters").ALL,u)}.bind(this))}.bind(this),this.$MercuryThreadlistContainer15=function(u){this.setState({isSearching:!!u})}.bind(this),this.$MercuryThreadlistContainer17=function(u,v){this.setState({showAggregation:true,aggregatedThreads:v});var w=c("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),x=[],y=v.map(function(z){x.push(c("MercuryIDs").getThreadKeyfromThreadIDUserID(z.thread_id,c("MercuryIDs").tokenize(w).value));return z.thread_id});this.props.onAggregationClick&&this.props.onAggregationClick(u,y);new(c("MessengerMessageRequestsTypedLogger"))().setAction("aggregation_entrypoint_tap").setEntryPoint("inbox_aggregation").setSurface("inbox").setFolderType("pending").setThreadKeyList(x.filter(function(z){return z}).join(", ")).log()}.bind(this),q}o.prototype.componentWillMount=function(){this.setState({showAggregation:c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs!==null})};o.prototype.componentDidMount=function(){__p&&__p();c("Bootloader").loadModules(["MercuryOrderedThreadlist","MercuryThreadInformer","MercuryThreads"],function(p,q,r){__p&&__p();if(this.props.resetAggregatedThreads)this.setState({showAggregation:false,aggregatedThreads:null});this.$MercuryThreadlistContainer1=p.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer2=r.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer3=function(s){__p&&__p();var t=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").INBOX,s);if(t.length===0)return t;var u=this.$MercuryThreadlistContainer2.getThreadMetaNow(t[t.length-1]);if(!u)return t;var v=u.timestamp,w=this.$MercuryThreadlistContainer1.getThreadlistUntilTimestamp(v,c("MessagingTag").PENDING,s);w.sort(function(y,z){var A=this.$MercuryThreadlistContainer2.getThreadMetaNow(y),B=this.$MercuryThreadlistContainer2.getThreadMetaNow(z);return(B&&B.timestamp)-(A&&A.timestamp)}.bind(this));var x=c("MercuryConfig").MCMA?this.$MercuryThreadlistContainer4(w):w;return t.concat(x).sort(function(y,z){var A=typeof y==="string"?this.$MercuryThreadlistContainer2.getThreadMetaNow(y):this.$MercuryThreadlistContainer2.getThreadMetaNow(y[0]),B=typeof z==="string"?this.$MercuryThreadlistContainer2.getThreadMetaNow(z):this.$MercuryThreadlistContainer2.getThreadMetaNow(z[0]);return(B&&B.timestamp)-(A&&A.timestamp)}.bind(this))}.bind(this);this.$MercuryThreadlistContainer5=q.getForFBID(this.props.viewer);this.$MercuryThreadlistContainer6=new(c("SubscriptionsHandler"))();this.$MercuryThreadlistContainer6.addSubscriptions(this.$MercuryThreadlistContainer5.subscribe("threadlist-updated",function(s,t){if(!this.state.suspended)this.handleThreadListUpdate()}.bind(this)));if(c("MercuryConfig").MessengerInboxRequests)this.$MercuryThreadlistContainer7(c("MessagingTag").PENDING,this.props.filter,this.$MercuryThreadlistContainer8(c("MessagingTag").PENDING)+c("MercuryThreadlistConstants").CONNECTION_REQUEST);this.$MercuryThreadlistContainer9(this.props.folder,this.props.filter)}.bind(this),"MercuryThreadlistContainer.react")};o.prototype.componentWillReceiveProps=function(p){if(p.resetAggregatedThreads!==this.props.resetAggregatedThreads||p.folder!==this.props.folder||p.filter!==this.props.filter||p.folder===c("MessagingTag").INBOX&&this.state.showAggregation==true)this.$MercuryThreadlistContainer9(p.folder,p.filter)};o.prototype.componentDidUpdate=function(){if(this.props.resetAggregatedThreads&&this.state.showAggregation)this.setState({showAggregation:false,aggregatedThreads:null})};o.prototype.componentWillUnmount=function(){this.$MercuryThreadlistContainer10();this.$MercuryThreadlistContainer11();this.$MercuryThreadlistContainer6&&this.$MercuryThreadlistContainer6.release()};o.prototype.handleThreadListUpdate=function(){this.$MercuryThreadlistContainer12(this.props.folder,this.props.filter);if(c("MercuryConfig").MessengerInboxRequests){this.props.folder===c("MessagingTag").INBOX&&this.$MercuryThreadlistContainer12(c("MessagingTag").PENDING,this.props.filter);this.props.folder===c("MessagingTag").PENDING&&this.$MercuryThreadlistContainer12(c("MessagingTag").INBOX,this.props.filter)}};o.prototype.render=function(){var p=this.props,q=p.ChildClass,r=p.folder,s=p.filter,t=babelHelpers.objectWithoutProperties(p,["ChildClass","folder","filter"]),u=this.state.isSearching?this.state.threads.get(k)||[]:this.state.threads.get(r)||[];return c("React").createElement(q,babelHelpers["extends"]({},t,{filter:s,folder:r,isLoaded:r==="aggregation"||!!this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer1.hasLoadedThreadlist(r,s),isLoading:this.state.isLoading,isSearching:this.state.isSearching,newMessageRequestThreads:this.state.unreadMessageRequestThreads,onRenderThreads:this.props.onRenderThreads,onMessageRequestsClick:this.props.onMessageRequestsClick,showAggregation:this.state.showAggregation,threads:this.state.aggregatedThreads||u,onLoadMoreRequest:this.$MercuryThreadlistContainer14,onQuery:this.$MercuryThreadlistContainer15,onSearchResults:this.$MercuryThreadlistContainer16,onAggregationClick:this.$MercuryThreadlistContainer17,p2pJewelBannerContainer:this.$MercuryThreadlistContainer18(),maxInitialThreadCount:n,handleChatTabOpen:this.props.source==="jewel"&&c("MercuryConfig").deferJewelUpdateOnChatOpen&&c("MercuryConfig").deferJewelUpdateOnChatOpen!=="none"?this.$MercuryThreadlistContainer13:c("emptyFunction")}))};o.prototype.$MercuryThreadlistContainer4=function(p){__p&&__p();var q=c("MercuryConfig").Unit||3,r=(c("MercuryConfig").Duration||3)*1e3*60*60*24,s=p.map(function(A){return this.$MercuryThreadlistContainer2.getThreadMetaNow(A).timestamp}.bind(this)),t=[];for(var u=0;u<s.length;u++){var v=s[u],w=s[u+q-1];if(w&&v-w<r){var x=[p[u]];for(var y=u+1;y<s.length;y++){var z=s[y];if(z&&v-z<r){x.push(p[y]);u++}else break}t.push(x)}else t.push(p[u])}return t};o.prototype.$MercuryThreadlistContainer18=function(){return c("gkx")("AT7KSMdBbHFSBSJn1JWZUBa76yZr8D9pobYWWvzliNi0RZQsDI29awNxAAPfpbtiIQHouKzRc3uiaxxHhFXpGQGFiE6SMOOJwNKziF0lagOtKg")?c("React").createElement(c("P2PJewelBannerContainer.react"),null):null};o.prototype.$MercuryThreadlistContainer9=function(p,q){__p&&__p();if(p==="aggregation")return;var r=c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs||this.props.threadIDs;if(!r)this.setState({showAggregation:false,aggregatedThreads:null});if(!c("MercuryConfig").MessengerInboxRequests&&p===c("MessagingTag").INBOX&&(c("gkx")("AT6h5--3KUdxbat1rL4n2mVcPcg9eZ8bwokXjpPZS-_sSShoFlPyHXdioNqIwODAz2vH7270MK0r4x8XFkaYt6-h")||this.props.source!==c("MercuryAPIArgsSource").JEWEL))this.$MercuryThreadlistContainer19();if(!this.$MercuryThreadlistContainer20(p,q))this.$MercuryThreadlistContainer7(p,q,n);else if(this.state.isLoading)this.setState({isLoading:false},function(){this.$MercuryThreadlistContainer12(p,q)}.bind(this));else this.$MercuryThreadlistContainer12(p,q)};o.prototype.$MercuryThreadlistContainer19=function(){this.$MercuryThreadlistContainer1.getFilteredThreadlist(c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,c("MercuryThreadlistConstants").MAX_UNREAD_COUNT,c("MessagingTag").PENDING,c("MercuryFilters").UNREAD,this.$MercuryThreadlistContainer21,true,this.props.source)};o.prototype.$MercuryThreadlistContainer7=function(p,q,r){__p&&__p();if(!this.$MercuryThreadlistContainer1)return;this.$MercuryThreadlistContainer11();this.threadListReqsInFlight++;var s=function(){var t=this.$MercuryThreadlistContainer1.getFilteredThreadlist(c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,r,p,q||c("MercuryFilters").ALL,function(u){this.threadListReqsInFlight--;if(this.threadListReqsInFlight===0)this.setState({isLoading:false})}.bind(this),true,this.props.source);this.$MercuryThreadlistContainer22={subscriberID:t,folder:p,filter:q}}.bind(this);if(this.state.isLoading)c("setImmediate")(s);else this.setState({isLoading:true},s)};o.prototype.$MercuryThreadlistContainer12=function(p,q,r){__p&&__p();if(!this.$MercuryThreadlistContainer1||!this.$MercuryThreadlistContainer2)return;this.$MercuryThreadlistContainer10();var s=void 0;if(c("MercuryConfig").MessengerInboxRequests&&p===c("MessagingTag").INBOX)s=this.$MercuryThreadlistContainer3(q);else if(p==="aggregation"||this.state.showAggregation){s=c("MessengerStateStore").getState()&&c("MessengerStateStore").getState().threadIDs||this.props.threadIDs;this.$MercuryThreadlistContainer23(s)}else s=r||this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(p,q);var t=[].concat.apply([],s);this.$MercuryThreadlistContainer24=this.$MercuryThreadlistContainer2.getMultiThreadMeta(t,function(r){this.setState({threads:this.state.threads.set(p,this.$MercuryThreadlistContainer25(s,r))})}.bind(this))};o.prototype.$MercuryThreadlistContainer23=function(p){__p&&__p();var q=this.$MercuryThreadlistContainer1.getAvailableThreadlistNow(c("MessagingTag").PENDING,this.props.filter);if(p&&p.length>0){var r=p.filter(function(s){return q.indexOf(s)!==-1});this.$MercuryThreadlistContainer2.getMultiThreadMeta(r,function(s){if(!Array.isArray(s))s=Object.values(s);this.setState({aggregatedThreads:s})}.bind(this))}else this.setState({aggregatedThreads:null})};o.prototype.$MercuryThreadlistContainer25=function(p,q){return p.map(function(r){if(Array.isArray(r))return r.map(function(s){return q[s]});else return q[r]})};o.prototype.$MercuryThreadlistContainer20=function(p,q){var r=n;return!!(this.$MercuryThreadlistContainer1&&(this.$MercuryThreadlistContainer1.getThreadCount(p,q)>=r||this.$MercuryThreadlistContainer1.hasLoadedThreadlist(p,q)))};o.prototype.$MercuryThreadlistContainer8=function(p){var q=this.state.threads.get(p);return q?q.length:0};o.prototype.$MercuryThreadlistContainer10=function(){this.$MercuryThreadlistContainer2&&this.$MercuryThreadlistContainer24&&this.$MercuryThreadlistContainer2.unsubscribe(this.$MercuryThreadlistContainer24)};o.prototype.$MercuryThreadlistContainer11=function(){this.$MercuryThreadlistContainer1&&this.$MercuryThreadlistContainer22&&this.$MercuryThreadlistContainer1.unsubscribe(this.$MercuryThreadlistContainer22.subscriberID,this.$MercuryThreadlistContainer22.folder,this.$MercuryThreadlistContainer22.filter)};o.propTypes={ChildClass:j.func.isRequired,filter:j.string.isRequired,folder:j.string.isRequired,onMessageRequestsClick:j.func,onRenderThreads:j.func,onAggregationClick:j.func,showCount:j.bool,showPresence:j.bool,source:j.string,threadCount:j.number,threadIDs:j.array,viewer:j.string.isRequired,onRenderBackArrow:j.func,resetAggregatedThreads:j.bool};o.defaultProps={source:c("MercuryAPIArgsSource").JEWEL};f.exports=o}),null);