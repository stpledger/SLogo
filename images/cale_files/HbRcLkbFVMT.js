if (self.CavalryLogger) { CavalryLogger.start_js(["Mucca"]); }

__d("FBRTCIceStatsParser",[],(function a(b,c,d,e,f,g){__p&&__p();var h=null;i.getInstance=function(){"use strict";if(!h)h=new i();return h};function i(){"use strict"}i.prototype.extractIceInfo=function(j){"use strict";var k=[],l=j.split("\r\n");for(var m=0;m<l.length;m++){var n=l[m];if(this.$FBRTCIceStatsParser1(n))k.push({gen:this.$FBRTCIceStatsParser2(n),type:this.$FBRTCIceStatsParser3(n)})}return k};i.prototype.$FBRTCIceStatsParser1=function(j){"use strict";return j.indexOf("candidate:")>-1};i.prototype.$FBRTCIceStatsParser2=function(j){"use strict";var k=0,l=j.match(/generation (\d+)/);if(l)k=parseInt(l[1],10);return k};i.prototype.$FBRTCIceStatsParser3=function(j){"use strict";var k=j.match(/typ (host|relay|srflx|prflx)/);if(k)return k[1];else return"unknown"};f.exports=i}),null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","FBRTCUtils","SiteData","UserAgentData","performanceNow"],(function a(b,c,d,e,f,g){__p&&__p();var h=5*60*1e3,i={CALL_STARTED:"started",SENT_OFFER:"s_o",RECV_OFFER:"r_o",SENT_OFFER_ACK:"s_oack",RECV_OFFER_ACK:"r_oack",SENT_RETRIED_OFFER:"s_o2",RECV_RETRIED_OFFER:"r_o2",SENT_RETRIED_OFFER_ACK:"s_oack2",RECV_RETRIED_OFFER_ACK:"r_oack2",SENT_PRANSWER:"s_pr",RECV_PRANSWER:"r_pr",NETWORK_READY:"network_ready",SENT_ANSWER:"s_a",RECV_ANSWER:"r_a",SENT_ANSWER_ACK:"s_aack",RECV_ANSWER_ACK:"r_aack",SENT_RETRIED_ANSWER:"s_a2",RECV_RETRIED_ANSWER:"r_a2",SENT_RETRIED_ANSWER_ACK:"s_aack2",RECV_RETRIED_ANSWER_ACK:"r_aack2",SENT_OK:"s_ok",RECV_OK:"r_ok",CALL_CONNECTED:"connected",CALL_ENDED:"ended"},j={POPUP_OPENED:"opened",PRESSED_ANSWER:"p_a"},k={ESCALATION_IS_AVAILABLE:"esc_available",USER_INITIATED_REQUEST:"out_started",RECEIVED_INCOMING_REQUEST:"inc_started",REJECTED_INVALID_P2P_STATE:"rej_invalid_state",CONNECTING_TO_MULTIWAY:"u_connecting_mw",CONNECTED_TO_MULTIWAY:"u_connected_mw",PEER_CONNECTING_TO_MULTIWAY:"p_connecting_mw",PEER_CONNECTED_TO_MULTIWAY:"p_connected_mw",READY_TO_ESCALATE:"ready_esc",PEER_FAILED_TO_CONNECT_TO_MULTIWAY:"p_fail_conn",MULTIWAY_CALL_ENDED:"mw_call_ended",TIMED_OUT:"timed_out",PEER_ABORTED:"p_aborted",INTERNAL_ERROR:"internal_err"};function l(m){"use strict";__p&&__p();this.peerID=String(m.peerID);this.callID=String(m.callID);this.$FBRTCCallSummary1=m.isCaller;this.$FBRTCCallSummary2=c("FBRTCUtils").getLocalUploadLogLevel();this.$FBRTCCallSummary12=new Date().valueOf();this.$FBRTCCallSummary3=null;this.$FBRTCCallSummary4={};this.$FBRTCCallSummary6={};this.$FBRTCCallSummary7={};this.$FBRTCCallSummary35=null;this.$FBRTCCallSummary36=null;this.$FBRTCCallSummary37=null;this.$FBRTCCallSummary14=0;this.$FBRTCCallSummary15=0;this.$FBRTCCallSummary34=false;this.$FBRTCCallSummary22={};this.$FBRTCCallSummary23={};this.$FBRTCCallSummary8={};this.$FBRTCCallSummary9={};this.$FBRTCCallSummary10={};this.$FBRTCCallSummary11={};this.$FBRTCCallSummary24=null;this.$FBRTCCallSummary17=c("performanceNow")();this.$FBRTCCallSummary13=0;this.$FBRTCCallSummary5={};this.$FBRTCCallSummary16=this.$FBRTCCallSummary17;this.$FBRTCCallSummary18=0;this.$FBRTCCallSummary19={};this.addExtraInfo(c("FBRTCLogger").Key.DEVICE_INFO,this.$FBRTCCallSummary38());this.$FBRTCCallSummary39();this.$FBRTCCallSummary21=c("FBRTCIceStatsParser").getInstance();this.$FBRTCCallSummary20=c("FBRTCLogger").getInstance()}l.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary15=new Date().valueOf();return JSON.stringify({version:l.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary1,uploadLogLevel:this.$FBRTCCallSummary2,clientVersion:this.$FBRTCCallSummary24,callType:this.$FBRTCCallSummary29,isUsingMultiway:this.$FBRTCCallSummary25,conferenceName:this.$FBRTCCallSummary27,activeConn:this.$FBRTCCallSummary26,escP2PCallID:this.$FBRTCCallSummary28,escConfName:this.$FBRTCCallSummary31,serverInfoData:this.$FBRTCCallSummary30,localVideoDuration:this.$FBRTCCallSummary32,remoteVideoDuration:this.$FBRTCCallSummary33,startTime:this.$FBRTCCallSummary12,trigger:this.$FBRTCCallSummary3,signalingTime:this.$FBRTCCallSummary4,escStateTimes:this.$FBRTCCallSummary6,applicationEventTime:this.$FBRTCCallSummary7,endCallReason:this.$FBRTCCallSummary35,endCallSubreason:this.$FBRTCCallSummary36,isRemoteEnded:this.$FBRTCCallSummary37,lastUpdatedTime:this.$FBRTCCallSummary14,lastSerializedTime:this.$FBRTCCallSummary15,unsetOnRetrieve:this.$FBRTCCallSummary34,openCount:this.$FBRTCCallSummary18,extraInfo:this.$FBRTCCallSummary19,pcStats:this.$FBRTCCallSummary22,captureStats:this.$FBRTCCallSummary23,gen0IceSentCount:this.$FBRTCCallSummary8,gen0IceReceivedCount:this.$FBRTCCallSummary9,iceSentCount:this.$FBRTCCallSummary10,iceReceivedCount:this.$FBRTCCallSummary11,newSignalingTime:this.$FBRTCCallSummary5,accumulatedCallTime:this.$FBRTCCallSummary40()})};l.fromJsonString=function(m){"use strict";__p&&__p();var n=void 0;try{n=JSON.parse(m)}catch(o){return null}if(n.version!==l.CURRENT_SUMMARY_VERSION)return null;if(!Object.prototype.hasOwnProperty.call(n,"peerID")||!Object.prototype.hasOwnProperty.call(n,"callID")||!Object.prototype.hasOwnProperty.call(n,"isCaller")||!Object.prototype.hasOwnProperty.call(n,"startTime")||!Object.prototype.hasOwnProperty.call(n,"trigger")||!Object.prototype.hasOwnProperty.call(n,"signalingTime")||!Object.prototype.hasOwnProperty.call(n,"endCallReason")||!Object.prototype.hasOwnProperty.call(n,"isRemoteEnded")||!Object.prototype.hasOwnProperty.call(n,"lastUpdatedTime")||!Object.prototype.hasOwnProperty.call(n,"lastSerializedTime"))return null;var p=new l({peerID:n.peerID,callID:n.callID,isCaller:n.isCaller});p.$FBRTCCallSummary2=n.uploadLogLevel;p.$FBRTCCallSummary24=n.clientVersion;p.$FBRTCCallSummary12=n.startTime;p.$FBRTCCallSummary3=n.trigger;p.$FBRTCCallSummary4=n.signalingTime;p.$FBRTCCallSummary35=n.endCallReason;p.$FBRTCCallSummary36=n.endCallSubreason;p.$FBRTCCallSummary37=n.isRemoteEnded;p.$FBRTCCallSummary14=n.lastUpdatedTime;p.$FBRTCCallSummary15=n.lastSerializedTime;if(n.callType)p.$FBRTCCallSummary29=n.callType;if(n.isUsingMultiway!=null)p.$FBRTCCallSummary25=n.isUsingMultiway;if(n.conferenceName)p.$FBRTCCallSummary27=n.conferenceName;if(n.escP2PCallID)p.$FBRTCCallSummary28=n.escP2PCallID;if(n.activeConn)p.$FBRTCCallSummary26=n.activeConn;if(n.escConfName)p.$FBRTCCallSummary31=n.escConfName;if(n.serverInfoData)p.$FBRTCCallSummary30=n.serverInfoData;if(n.localVideoDuration)p.$FBRTCCallSummary32=n.localVideoDuration;if(n.remoteVideoDuration)p.$FBRTCCallSummary33=n.remoteVideoDuration;if(n.unsetOnRetrieve)p.$FBRTCCallSummary34=n.unsetOnRetrieve;if(n.openCount)p.$FBRTCCallSummary18=n.openCount;if(n.extraInfo)p.$FBRTCCallSummary19=n.extraInfo;if(n.pcStats)p.$FBRTCCallSummary22=n.pcStats;if(n.captureStats)p.$FBRTCCallSummary23=n.captureStats;if(n.gen0IceSentCount)p.$FBRTCCallSummary8=n.gen0IceSentCount;if(n.gen0IceReceivedCount)p.$FBRTCCallSummary9=n.gen0IceReceivedCount;if(n.iceSentCount)p.$FBRTCCallSummary10=n.iceSentCount;if(n.iceReceivedCount)p.$FBRTCCallSummary11=n.iceReceivedCount;if(n.newSignalingTime)p.$FBRTCCallSummary5=n.newSignalingTime;if(n.accumulatedCallTime)p.$FBRTCCallSummary13=n.accumulatedCallTime;if(n.escStateTimes)p.$FBRTCCallSummary6=n.escStateTimes;if(n.applicationEventTime)p.$FBRTCCallSummary7=n.applicationEventTime;return p};l.restoreOrInitialize=function(m,n,o,p,q,r){"use strict";__p&&__p();n=String(n);o=String(o);var s=m.retrieveCallSummary(n,o);if(!s){s=new l({peerID:n,callID:o,isCaller:p});if(q){s.onFullMessageReceived({msg:q});s.onOfferAckSent(q)}else s.onCallStarted(r||c("FBRTCLogger").Trigger.UNKNOWN);c("FBRTCLogger").getInstance().logError(n,o,"Missing call summary from storage")}else if(s.$FBRTCCallSummary34){s.$FBRTCCallSummary35=null;s.$FBRTCCallSummary36=null;s.$FBRTCCallSummary37=null;delete s.$FBRTCCallSummary4[i.CALL_ENDED];delete s.$FBRTCCallSummary5[i.CALL_ENDED];s.$FBRTCCallSummary34=null}return s};l.logSavedSummaries=function(m){"use strict";__p&&__p();var n=m.getLoggableSummaries(),o=n.length;if(o<=0)return;var p=c("FBRTCLogger").getInstance(),q=[];for(var r=0;r<o;r++){var s=n[r];p.logEndCallSummary(s);q.push({peerID:s.peerID,callID:s.callID})}m.removeCallSummaries(q);p.logToConsole("Logged pending summaries: "+o)};l.prototype.save=function(m){"use strict";var n=c("performanceNow")(),o=n-this.$FBRTCCallSummary16;if(o>h){this.$FBRTCCallSummary20.logInfo(this.peerID,this.callID,"Summary too old: "+o);return}m.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummary16=n};l.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary14};l.prototype.setLastUpdatedTime=function(m){"use strict";this.$FBRTCCallSummary14=m};l.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummary19};l.prototype.getCallTrigger=function(){"use strict";return this.$FBRTCCallSummary3};l.prototype.addExtraInfo=function(m,n){"use strict";this.$FBRTCCallSummary19[m]=n;this.$FBRTCCallSummary39()};l.prototype.isCaller=function(){"use strict";return this.$FBRTCCallSummary1};l.prototype.isNetworkReady=function(){"use strict";if(this.$FBRTCCallSummary4[i.NETWORK_READY])return true;else return false};l.prototype.isAnswerReceived=function(){"use strict";if(this.$FBRTCCallSummary4[i.RECV_ANSWER])return true;else return false};l.prototype.onCallStarted=function(m){"use strict";this.$FBRTCCallSummary3=m;this.$FBRTCCallSummary41(i.CALL_STARTED);this.$FBRTCCallSummary39()};l.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummary42(j.POPUP_OPENED);this.$FBRTCCallSummary18++;this.$FBRTCCallSummary39()};l.prototype.onPressedAnswer=function(){"use strict";this.$FBRTCCallSummary42(j.PRESSED_ANSWER);this.$FBRTCCallSummary39()};l.prototype.setPcStats=function(m){"use strict";this.$FBRTCCallSummary22=m;this.$FBRTCCallSummary39()};l.prototype.setVideoCaptureStats=function(m,n){"use strict";this.$FBRTCCallSummary23={w:m,h:n};this.$FBRTCCallSummary39()};l.prototype.setVideoCaptureConstraints=function(m){"use strict";this.$FBRTCCallSummary23=m;this.$FBRTCCallSummary39()};l.prototype.setUploadLogLevel=function(m){"use strict";this.$FBRTCCallSummary2=m;this.$FBRTCCallSummary39()};l.prototype.getCallType=function(){"use strict";return this.$FBRTCCallSummary29};l.prototype.setCallType=function(m){"use strict";this.$FBRTCCallSummary29=m;this.addExtraInfo("call_type",m);this.$FBRTCCallSummary39()};l.prototype.setVideoDurations=function(m,n){"use strict";this.$FBRTCCallSummary32=m;this.$FBRTCCallSummary33=n;this.$FBRTCCallSummary39()};l.prototype.setScreenDuration=function(m){"use strict";this.addExtraInfo(c("FBRTCLogger").Key.SCREEN_DURATION,m)};l.prototype.setIsUsingMultiway=function(m){"use strict";this.$FBRTCCallSummary25=m;this.$FBRTCCallSummary39()};l.prototype.setConferenceName=function(m){"use strict";this.$FBRTCCallSummary27=m;this.$FBRTCCallSummary39()};l.prototype.setServerInfoData=function(m){"use strict";this.$FBRTCCallSummary30=m;this.$FBRTCCallSummary39()};l.prototype.setActiveConnection=function(m){"use strict";this.$FBRTCCallSummary26=m;this.$FBRTCCallSummary39()};l.prototype.setEscalationP2PCallID=function(m){"use strict";this.$FBRTCCallSummary28=m;this.$FBRTCCallSummary39()};l.prototype.setEscalationConferenceName=function(m){"use strict";this.$FBRTCCallSummary31=m;this.$FBRTCCallSummary39()};l.prototype.onOfferAckSent=function(m){"use strict";this.onMessageSent({type:c("FBRTCConstants").PayloadType.OFFER_ACK,flag:m.flag})};l.prototype.onMessageSent=function(m){"use strict";__p&&__p();var n=m.flag===1;switch(m.type){case c("FBRTCConstants").PayloadType.OFFER:this.$FBRTCCallSummary43(n,i.SENT_OFFER,i.SENT_RETRIED_OFFER);this.$FBRTCCallSummary44(m,this.$FBRTCCallSummary8,this.$FBRTCCallSummary10);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCCallSummary43(n,i.SENT_ANSWER,i.SENT_RETRIED_ANSWER);this.$FBRTCCallSummary44(m,this.$FBRTCCallSummary8,this.$FBRTCCallSummary10);break;case c("FBRTCConstants").PayloadType.OK:this.$FBRTCCallSummary41(i.SENT_OK);break;case c("FBRTCConstants").PayloadType.PRANSWER:this.$FBRTCCallSummary41(i.SENT_PRANSWER);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$FBRTCCallSummary43(n,i.SENT_OFFER_ACK,i.SENT_RETRIED_OFFER_ACK);break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$FBRTCCallSummary43(n,i.SENT_ANSWER_ACK,i.SENT_RETRIED_ANSWER_ACK);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary44(m,this.$FBRTCCallSummary8,this.$FBRTCCallSummary10);break;default:}this.$FBRTCCallSummary39()};l.prototype.$FBRTCCallSummary44=function(m,n,o){"use strict";var p=null,q=null,r=this.$FBRTCCallSummary21.extractIceInfo(m.sdp);for(var s=0;s<r.length;s++){p=r[s].gen;q=r[s].type;if(p===0)this.$FBRTCCallSummary45(n,q);this.$FBRTCCallSummary45(o,q)}};l.prototype.$FBRTCCallSummary45=function(m,n){"use strict";if(!m[n])m[n]=1;else m[n]=m[n]+1};l.prototype.$FBRTCCallSummary46=function(m){"use strict";this.addExtraInfo(c("FBRTCLogger").Key.PEER_IS_MOBILE,m.isFromMobile()?"1":"0")};l.prototype.onFullMessageReceived=function(m){"use strict";__p&&__p();var n=m.msg,o=n.flag===1;switch(n.type){case c("FBRTCConstants").PayloadType.OFFER:this.$FBRTCCallSummary46(m);this.$FBRTCCallSummary43(o,i.RECV_OFFER,i.RECV_RETRIED_OFFER);this.$FBRTCCallSummary44(n,this.$FBRTCCallSummary9,this.$FBRTCCallSummary11);break;case c("FBRTCConstants").PayloadType.ANSWER:this.$FBRTCCallSummary46(m);this.$FBRTCCallSummary43(o,i.RECV_ANSWER,i.RECV_RETRIED_ANSWER);this.$FBRTCCallSummary44(n,this.$FBRTCCallSummary9,this.$FBRTCCallSummary11);break;case c("FBRTCConstants").PayloadType.OK:this.$FBRTCCallSummary41(i.RECV_OK);break;case c("FBRTCConstants").PayloadType.PRANSWER:this.$FBRTCCallSummary41(i.RECV_PRANSWER);break;case c("FBRTCConstants").PayloadType.OFFER_ACK:this.$FBRTCCallSummary43(o,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);break;case c("FBRTCConstants").PayloadType.ANSWER_ACK:this.$FBRTCCallSummary43(o,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK);break;case c("FBRTCConstants").PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummary44(n,this.$FBRTCCallSummary9,this.$FBRTCCallSummary11);break;default:}this.$FBRTCCallSummary39()};l.prototype.onMsgAckReceived=function(m,n){"use strict";var o=m.msg.flag===1;if(n)this.$FBRTCCallSummary43(o,i.RECV_OFFER_ACK,i.RECV_RETRIED_OFFER_ACK);else this.$FBRTCCallSummary43(o,i.RECV_ANSWER_ACK,i.RECV_RETRIED_ANSWER_ACK)};l.prototype.onNetworkReady=function(){"use strict";this.$FBRTCCallSummary41(i.NETWORK_READY);this.$FBRTCCallSummary39()};l.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummary41(i.CALL_CONNECTED);this.$FBRTCCallSummary39()};l.prototype.onCallEnded=function(m,n,o,p){"use strict";this.$FBRTCCallSummary34=o;this.$FBRTCCallSummary35=String(m);this.$FBRTCCallSummary36=p;this.$FBRTCCallSummary37=n;this.$FBRTCCallSummary41(i.CALL_ENDED);this.$FBRTCCallSummary39()};l.prototype.setOfferSentTime=function(){"use strict";this.$FBRTCCallSummary41(i.SENT_OFFER)};l.prototype.setOfferAckReceivedTime=function(){"use strict";this.$FBRTCCallSummary41(i.RECV_OFFER_ACK)};l.prototype.setAnswerSentTime=function(){"use strict";this.$FBRTCCallSummary41(i.SENT_ANSWER)};l.prototype.setAnswerReceivedTime=function(){"use strict";this.$FBRTCCallSummary41(i.RECV_ANSWER)};l.prototype.setEscalationAvailable=function(){"use strict";this.$FBRTCCallSummary47(k.ESCALATION_IS_AVAILABLE)};l.prototype.setEscalationInitiated=function(){"use strict";this.$FBRTCCallSummary47(k.USER_INITIATED_REQUEST)};l.prototype.setReceivedEscalationRequest=function(){"use strict";this.$FBRTCCallSummary47(k.RECEIVED_INCOMING_REQUEST)};l.prototype.setInvalidP2PEscalationState=function(){"use strict";this.$FBRTCCallSummary47(k.REJECTED_INVALID_P2P_STATE)};l.prototype.setEscalationConnectingToMultiway=function(){"use strict";this.$FBRTCCallSummary47(k.CONNECTING_TO_MULTIWAY)};l.prototype.setEscalationConnectedToMultiway=function(){"use strict";this.$FBRTCCallSummary47(k.CONNECTED_TO_MULTIWAY)};l.prototype.setEscalationPeerConnectingToMultiway=function(){"use strict";this.$FBRTCCallSummary47(k.PEER_CONNECTING_TO_MULTIWAY)};l.prototype.setEscalationPeerConnectedToMultiway=function(){"use strict";this.$FBRTCCallSummary47(k.PEER_CONNECTED_TO_MULTIWAY)};l.prototype.setReadyToEscalate=function(){"use strict";this.$FBRTCCallSummary47(k.READY_TO_ESCALATE)};l.prototype.setEscalationPeerFailedToConnectToMultiway=function(){"use strict";this.$FBRTCCallSummary47(k.PEER_FAILED_TO_CONNECT_TO_MULTIWAY)};l.prototype.setEscalationTimedOut=function(){"use strict";this.$FBRTCCallSummary47(k.TIMED_OUT)};l.prototype.toString=function(){"use strict";var m={};m.core_metrics=this.$FBRTCCallSummary48();m.time_series=null;return JSON.stringify(m)};l.prototype.$FBRTCCallSummary48=function(){"use strict";__p&&__p();var m={};m.ver=l.CURRENT_SUMMARY_VERSION;m.log_level=c("FBRTCConstants").uploadLogLevelString(this.$FBRTCCallSummary2);m.caller=this.$FBRTCCallSummary1;m.call_type=this.$FBRTCCallSummary29;m.is_using_multiway=this.$FBRTCCallSummary25;m.active_conn=this.$FBRTCCallSummary26;m.app_event_times=this.$FBRTCCallSummary7;m.conf_name=this.$FBRTCCallSummary27;m.esc_p2p_call_id=this.$FBRTCCallSummary28;m.esc_state_times=this.$FBRTCCallSummary6;m.esc_conf_name=this.$FBRTCCallSummary31;m.serv_info=this.$FBRTCCallSummary30;m.conn=this.$FBRTCCallSummary49();m.peer_id=this.peerID;m.has_video=true;m.open_count=this.$FBRTCCallSummary18;m.signaling=this.$FBRTCCallSummary50();m.sender=this.$FBRTCCallSummary51();m.receiver=this.$FBRTCCallSummary52();m.end=this.$FBRTCCallSummary53();m.video=this.$FBRTCCallSummary54();m.push_phase=c("SiteData").push_phase;m.client_version=this.$FBRTCCallSummary24;return m};l.prototype.$FBRTCCallSummary49=function(){"use strict";var m={dtls:1};if(this.$FBRTCCallSummary22.sender&&this.$FBRTCCallSummary22.sender.rtt)m.rtt=this.$FBRTCCallSummary22.sender.rtt;return m};l.prototype.$FBRTCCallSummary50=function(){"use strict";__p&&__p();var m={};if(this.$FBRTCCallSummary3)m.trigger=this.$FBRTCCallSummary3;m.start_time=this.$FBRTCCallSummary12;m.time_from_start=this.$FBRTCCallSummary4;var n=this.$FBRTCCallSummary4[i.CALL_CONNECTED],o=this.$FBRTCCallSummary4[i.CALL_ENDED];if(n){if(!o)if(this.$FBRTCCallSummary15)o=this.$FBRTCCallSummary15-this.$FBRTCCallSummary12;else o=this.$FBRTCCallSummary55();var p=o-n;if(p>0)m.duration=p}m.new_time_from_start=this.$FBRTCCallSummary5;n=this.$FBRTCCallSummary5[i.CALL_CONNECTED];o=this.$FBRTCCallSummary5[i.CALL_ENDED];if(n){if(!o)if(this.$FBRTCCallSummary13>0)o=this.$FBRTCCallSummary13;else o=this.$FBRTCCallSummary40();var q=o-n;if(q>0)m.new_duration=q}return m};l.prototype.$FBRTCCallSummary51=function(){"use strict";var m={};if(this.$FBRTCCallSummary8)m.ice_g0=this.$FBRTCCallSummary8;if(this.$FBRTCCallSummary10)m.ice=this.$FBRTCCallSummary10;if(this.$FBRTCCallSummary22.sender)Object.assign(m,this.$FBRTCCallSummary22.sender);return m};l.prototype.$FBRTCCallSummary52=function(){"use strict";var m={};if(this.$FBRTCCallSummary9)m.ice_g0=this.$FBRTCCallSummary9;if(this.$FBRTCCallSummary11)m.ice=this.$FBRTCCallSummary11;return m};l.prototype.$FBRTCCallSummary53=function(){"use strict";__p&&__p();var m={};if(this.$FBRTCCallSummary35!==null){m.end_call_reason_string=c("FBRTCConstants").callEndReasonString(this.$FBRTCCallSummary35);if(this.$FBRTCCallSummary36!==null)m.end_call_subreason_string=this.$FBRTCCallSummary36;m.remote_ended=this.$FBRTCCallSummary37}if(this.$FBRTCCallSummary22.end)Object.assign(m,this.$FBRTCCallSummary22.end);return m};l.prototype.$FBRTCCallSummary54=function(){"use strict";var m={capture:{}};if(this.$FBRTCCallSummary22.video&&this.$FBRTCCallSummary22.video.sender)Object.assign(m,this.$FBRTCCallSummary22.video.sender);if(this.$FBRTCCallSummary23)Object.assign(m.capture,this.$FBRTCCallSummary23);return{sender:m,ld:this.$FBRTCCallSummary32,rd:this.$FBRTCCallSummary33}};l.prototype.$FBRTCCallSummary55=function(){"use strict";return new Date().valueOf()-this.$FBRTCCallSummary12};l.prototype.$FBRTCCallSummary40=function(){"use strict";var m=c("performanceNow")()-this.$FBRTCCallSummary17;return Math.floor(this.$FBRTCCallSummary13+m)};l.prototype.$FBRTCCallSummary41=function(m){"use strict";if(this.$FBRTCCallSummary4[m])return;this.$FBRTCCallSummary4[m]=this.$FBRTCCallSummary55();this.$FBRTCCallSummary5[m]=this.$FBRTCCallSummary40()};l.prototype.$FBRTCCallSummary47=function(m){"use strict";if(this.$FBRTCCallSummary6[m])return;this.$FBRTCCallSummary6[m]=this.$FBRTCCallSummary55()};l.prototype.$FBRTCCallSummary42=function(event){"use strict";if(this.$FBRTCCallSummary7[event])return;this.$FBRTCCallSummary7[event]=this.$FBRTCCallSummary55()};l.prototype.$FBRTCCallSummary43=function(m,n,o){"use strict";if(m)this.$FBRTCCallSummary41(o);else this.$FBRTCCallSummary41(n)};l.prototype.$FBRTCCallSummary39=function(){"use strict";this.$FBRTCCallSummary14=new Date().valueOf()};l.prototype.$FBRTCCallSummary38=function(){"use strict";return{device:c("UserAgentData").deviceName,os:c("UserAgentData").platformName,os_version:c("UserAgentData").platformFullVersion,browser:c("UserAgentData").browserName,browser_version:c("UserAgentData").browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth}};l.prototype.setClientVersion=function(m){"use strict";this.$FBRTCCallSummary24=m};l.prototype.getCallDuration=function(){"use strict";var m=this.$FBRTCCallSummary50();return m.duration?m.duration:0};l.CURRENT_SUMMARY_VERSION=19;f.exports=l}),null);
__d("FBRTCCallSummaryStore",["CacheStorage","FBRTCCallSummary","FBRTCLogger","areEqual"],(function a(b,c,d,e,f,g){__p&&__p();var h="localstorage",i="RTC_CALL_SUMMARY_",j="summary",k=2e3,l=3,m=3*60*1e3,n=null;o.getInstance=function(){"use strict";if(!n)n=new o();return n};function o(){"use strict";this.$FBRTCCallSummaryStore1=new(c("CacheStorage"))(h,i);this.$FBRTCCallSummaryStore2=c("FBRTCLogger").getInstance()}o.prototype.storeCallSummary=function(p,q,r){"use strict";__p&&__p();var s=this;this.$FBRTCCallSummaryStore3(function(t){__p&&__p();if(!t[p])t[p]={};var u=t[p][q];if(u){var v=s.$FBRTCCallSummaryStore4(u);if(v&&v.getLastUpdatedTime()>r.getLastUpdatedTime()){s.$FBRTCCallSummaryStore2.logToConsole("Outdated summaries");return null}}t[p][q]=s.$FBRTCCallSummaryStore5(r);return t},s.$FBRTCCallSummaryStore2.logError.bind(s.$FBRTCCallSummaryStore2,p,q))};o.prototype.retrieveCallSummary=function(p,q){"use strict";var r=this.$FBRTCCallSummaryStore6(),s=null;if(r[p])s=r[p][q];if(s)return this.$FBRTCCallSummaryStore4(s);else return null};o.prototype.removeCallSummary=function(p,q){"use strict";this.removeCallSummaries([{peerID:p,callID:q}])};o.prototype.removeCallSummaries=function(p){"use strict";__p&&__p();var q=this;this.$FBRTCCallSummaryStore3(function(r){__p&&__p();var s=p.length;for(var t=0;t<s;t++){var u=p[t].peerID,v=p[t].callID;if(r[u]&&r[u][v]){delete r[u][v];if(q.$FBRTCCallSummaryStore7(r[u]))delete r[u]}}return r},q.$FBRTCCallSummaryStore2.logError.bind(q.$FBRTCCallSummaryStore2,null,null))};o.prototype.getLoggableSummaries=function(){"use strict";__p&&__p();var p=this.$FBRTCCallSummaryStore6(),q=[];for(var r in p)if(Object.prototype.hasOwnProperty.call(p,r))for(var s in p[r])if(Object.prototype.hasOwnProperty.call(p[r],s)){var t=this.$FBRTCCallSummaryStore4(p[r][s],m);if(t)q.push(t)}return q};o.prototype.$FBRTCCallSummaryStore7=function(p){"use strict";for(var q in p)if(Object.prototype.hasOwnProperty.call(p,q))return false;return true};o.prototype.$FBRTCCallSummaryStore5=function(p){"use strict";var q={__t:Date.now(),__d:p.toJsonString()};return q};o.prototype.$FBRTCCallSummaryStore4=function(p,q){"use strict";if(p)if(!q||Date.now()-p.__t>=q)return c("FBRTCCallSummary").fromJsonString(p.__d);return null};o.prototype.$FBRTCCallSummaryStore6=function(){"use strict";var p=this.$FBRTCCallSummaryStore1.get(j)||{};return p};o.prototype.$FBRTCCallSummaryStore3=function(p,q,r,s){__p&&__p();var t,u=this;"use strict";if(r===undefined||r===null)r=l;var v=this.$FBRTCCallSummaryStore6(),w=this.$FBRTCCallSummaryStore6(),x=p(v);if(x===null)return;var y=this.$FBRTCCallSummaryStore6();if(c("areEqual")(w,y)){this.$FBRTCCallSummaryStore1.set(j,x);this.$FBRTCCallSummaryStore2.logToConsole("Updated summaries")}else if(r>0){q("Retry lock");if(s)(function(){var z=u;setTimeout(function(){z.$FBRTCCallSummaryStore3(p,q,r-1,true)},k)})();else this.$FBRTCCallSummaryStore3(p,q,r-1,true)}else q("Failed to lock")};f.exports=o}),null);
__d("FBRTCLocalMessageQueue",["CacheStorage","FBRTCConsoleLogger","Map"],(function a(b,c,d,e,f,g){__p&&__p();var h="localstorage",i="RTC_",j="offer",k="offer_msg",l="data_",m=30*1e3,n=15*1e3,o=500,p=new(c("Map"))();function q(){"use strict";this.$FBRTCLocalMessageQueue1=c("FBRTCConsoleLogger").getInstance()}q.prototype.enqueueOffer=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue2(r,k);this.$FBRTCLocalMessageQueue3(t,j,s)};q.prototype.getOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue2(r,k);return this.$FBRTCLocalMessageQueue4(s,j)};q.prototype.removeOffer=function(r){"use strict";var s=this.$FBRTCLocalMessageQueue2(r,k);s.remove(j)};q.prototype.enqueueMessage=function(r,s,t,u){"use strict";var v=l+t.toString(),w=p.get(r)||new(c("Map"))();w.set(v,u);p.set(r,w);this.$FBRTCLocalMessageQueue1.log("Queued "+v)};q.prototype.drainQueue=function(r,s){"use strict";__p&&__p();var t=p.get(r)||new(c("Map"))(),u=void 0,v=void 0;for(var w=t,x=Array.isArray(w),y=0,w=x?w:w[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var z;if(x){if(y>=w.length)break;z=w[y++]}else{y=w.next();if(y.done)break;z=y.value}var A=z,u=A[0],v=A[1];void u;s(v)}p.set(r,new(c("Map"))())};q.prototype.enableDequeuing=function(r,s,t,u){"use strict";if(u===undefined)u=n;this.$FBRTCLocalMessageQueue5(r,s,t,u)};q.prototype.$FBRTCLocalMessageQueue5=function(r,s,t,u){"use strict";__p&&__p();var v=this.$FBRTCLocalMessageQueue2(r,s),w=v.keys(),x=w.length;for(var y=0;y<x;y++){var z=this.$FBRTCLocalMessageQueue6(v,w[y]);if(z&&t)t(z)}this.$FBRTCLocalMessageQueue1.log("Dequeued "+x+" ("+r+") with "+u+" left)");if(u>0){u-=o;setTimeout(function(){this.$FBRTCLocalMessageQueue5(r,s,t,u)}.bind(this),o)}};q.prototype.$FBRTCLocalMessageQueue3=function(r,s,t){"use strict";var u={__t:Date.now(),__d:t};r.set(s,u)};q.prototype.$FBRTCLocalMessageQueue4=function(r,s){"use strict";var t=r.get(s);if(t&&this.$FBRTCLocalMessageQueue7(t))return t.__d;else if(t)r.remove(s);return null};q.prototype.$FBRTCLocalMessageQueue6=function(r,s){"use strict";var t=this.$FBRTCLocalMessageQueue4(r,s);if(t!==null){r.remove(s);return t}return null};q.prototype.$FBRTCLocalMessageQueue7=function(r){"use strict";return Date.now()-r.__t<m};q.prototype.$FBRTCLocalMessageQueue2=function(r,s){"use strict";return new(c("CacheStorage"))(h,""+i+r+"_"+s+"_")};f.exports=q}),null);
__d("FBRTCMessageListener",["invariant","Arbiter","ChannelConstants","FBRTCCallControlActions","FBRTCConstants","FBRTCLocalMessageQueue","FBRTCSupport","RTCConfig","guid","mixInEventEmitter"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("FBRTCConstants").ChildWindowMessageType,j=45*1e3,k=[],l=null,m=null,n=null,o=null,p=null,q=false,r=null,s=void 0,t={init:function u(v,w){__p&&__p();if(q)return;q=true;c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc_offer"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("webrtc_offerack"),function(y,z){this._onMessage(z.obj)}.bind(this));c("Arbiter").subscribe(c("ChannelConstants").getArbiterType("rtc_multi_json"),function(y,z){this._onMultiwayMessage(z.obj)}.bind(this));this._localMessageQueue=new(c("FBRTCLocalMessageQueue"))();if(c("RTCConfig").PassMessagesBetweenWindowsGK){if(c("FBRTCSupport").isWebrtcSupported()&&window.addEventListener){var x=v?this._handleWindowMessageToChild.bind(this):this._handleWindowMessageToParent.bind(this);window.addEventListener("message",x,false)}if(v)this._connectToParentWindow(w)}},setParentWindowNonce:function u(v){o=v},generateNewNonce:function u(){p=c("guid")();return p},setMultiwayMessageHandler:function u(v,w){!r||h(0);r=w?v.bind(w):v},_onMultiwayMessage:function u(v){this.emit("multiwayMessageReceived",v);if(r)r(v)},setMessageHandler:function u(v,w){!l||h(0);l=w?v.bind(w):v;while(k.length)l(k.shift())},removeMessageHandler:function u(){l=null},setParentWindowStartCallHandler:function u(v){s=v;return function(){return s=null}},_onMessage:function u(v){if(v.from)v.from=v.from.toString();this.emit("messageReceived",v);if(l)l(v);else k.push(v);this._passMessageToChildWindow(v)},_connectToParentWindow:function u(v){if(window.opener&&window.opener.postMessage){var w={type:i.CHILD_WINDOW_READY,nonce:o,childNonce:this.generateNewNonce(),peerID:v};window.opener.postMessage(w,window.location.origin)}},_verifyWindowMessage:function u(event){return event.origin===window.location.origin&&event.data&&p&&event.data.nonce===p},_handleWindowMessageToParent:function u(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===i.CHILD_WINDOW_READY){this.setParentWindowNonce(event.data.childNonce);this._setChildWindow(event.source);this._replayQueuedMessagesToChild(event.data.peerID,m)}},_handleWindowMessageToChild:function u(event){if(!this._verifyWindowMessage(event))return;if(event.data.type===i.CHILD_WINDOW_MESSAGE)this._onMessage(event.data.message);if(event.data.type===i.CHILD_WINDOW_START_CALL)if(s)s();else c("FBRTCCallControlActions").parentWindowStartCall()},_replayQueuedMessagesToChild:function u(v,w){this._localMessageQueue.drainQueue(v,function(x){var y={type:i.CHILD_WINDOW_MESSAGE,nonce:o,message:x};w.postMessage(y,window.location.origin)})},_setChildWindow:function u(v){m=v;clearTimeout(n);n=setTimeout(function(){m=null},j);this._startCallInChildWindow();this.generateNewNonce()},_passMessageToChildWindow:function u(v){if(m){var w={type:i.CHILD_WINDOW_MESSAGE,nonce:o,message:v};m.postMessage(w,window.location.origin)}},_startCallInChildWindow:function u(){if(m){var v={type:i.CHILD_WINDOW_START_CALL,nonce:o};m.postMessage(v,window.location.origin)}}};c("mixInEventEmitter")(t,{messageReceived:true,multiwayMessageReceived:true});f.exports=t}),null);
__d("XGroupCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/{?conference_name}/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:true},server_info_data:{type:"String"},nonce:{type:"String"}})}),null);
__d("XGroupCallSigningController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/groupcall/init/",{conference_name:{type:"String",required:true},call_id:{type:"Int"},users_to_ring:{type:"FBIDSet",defaultValue:[]},has_video:{type:"Bool",defaultValue:false},server_info_data:{type:"String"},nonce:{type:"String"}})}),null);
__d("XVideoCallController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/incall/",{peer_id:{type:"FBID",required:true},call_id:{type:"Int"},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}})}),null);
__d("XVideoCallInitController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/videocall/init/",{peer_id:{type:"FBID",required:true},call_id:{type:"Int",required:true},is_caller:{type:"Bool",defaultValue:false},audio_only:{type:"Bool",defaultValue:false},nonce:{type:"String"}})}),null);
__d("XWirelessScreenSharingController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/screen_sharing/{?session_id}/",{nonce:{type:"String"},peer_id:{type:"FBID",required:true},session_id:{type:"Int"}})}),null);
__d("FBRTCUrlManager",["regeneratorRuntime","Promise","CurrentUser","FBRTCConfig","FBRTCLogger","FBRTCUtils","MessengerRTCFunnelLogger","URI","XGroupCallController","XGroupCallSigningController","XVideoCallController","XVideoCallInitController","XWirelessScreenSharingController"],(function a(b,c,d,e,f,g){__p&&__p();var h=3,i=function i(p,q,r,s){c("FBRTCLogger").getInstance().logCallAction(p,q,c("FBRTCLogger").CallAction.OLD_URI);return c("XVideoCallController").getURIBuilder().setFBID("peer_id",p).setInt("call_id",q).setBool("is_caller",r).setBool("audio_only",s).getURI()},j=function j(p,q,r,s,t,u){__p&&__p();var v=arguments.length<=6||arguments[6]===undefined?h:arguments[6],w=arguments.length<=7||arguments[7]===undefined?"":arguments[7];if(v===undefined||v===null)v=h;var x=c("XVideoCallInitController").getURIBuilder().setFBID("peer_id",p).setInt("call_id",q).setBool("is_caller",r).setBool("audio_only",s).getURI();x=c("FBRTCUtils").isPeerVCEndpoint(p)||c("FBRTCUtils").isCollabTrigger(w)?k(x):x;c("FBRTCUtils").sendServerRequest(x,function(y){t(y.payload.uri)},function(y){if(v>0)j(p,q,r,s,t,u,v-1,w);else t(i(p,q,r,s))})};function k(p){if(c("CurrentUser").isEmployee()){p=p.setSubdomain(c("CurrentUser").hasWorkUser()||c("CurrentUser").isWorkUser()?"fb":"www");var q="/intern/";return c("URI").getRequestURI().getPath().substr(0,q.length)!==q?p:p.setDomain(p.getDomain().toString().replace(/\.(intern|internmc|cstools)\./,"."))}return p}function l(p){__p&&__p();var q=p.conferenceName,r=p.callID,s=p.usersToRing,t=p.hasVideo,u=p.nonce,v=p.serverInfoData,w;return c("regeneratorRuntime").async(function x(y){while(1)switch(y.prev=y.next){case 0:w=c("XGroupCallSigningController").getURIBuilder().setString("conference_name",q).setInt("call_id",r).setFBIDSet("users_to_ring",s).setBool("has_video",t).setString("server_info_data",v).setString("nonce",u).getURI();return y.abrupt("return",new(c("Promise"))(function(z,A){c("FBRTCUtils").sendServerRequest(w,function(B){c("MessengerRTCFunnelLogger").appendAction("got_server_call_uri");z(B.payload.uri)},function(B){A(B)})}));case 2:case"end":return y.stop()}},null,this)}var m=function m(p,q,r,s,t,u,v){__p&&__p();if(v===undefined||v===null)v=h;var w=c("XGroupCallSigningController").getURIBuilder().setFBID("call_id",p).setBool("is_caller",r).setBool("audio_only",s).setFBIDSet("users_to_ring",q).getURI();c("FBRTCUtils").sendServerRequest(w,function(x){t(x.payload.uri)},function(x){if(v>0)m(p,q,r,s,t,u,v-1);else{var y=c("XGroupCallController").getURIBuilder().setFBID("call_id",p).setBool("is_caller",r).setBool("audio_only",s).setFBIDSet("users_to_ring",q).getURI();t(y)}})},n=function n(p){if(c("FBRTCConfig").disableURLManager())return;window.history.replaceState({},"",p)},o={init:function p(q){this._peerID=q},onCallStarted:function p(){n(i(this._peerID))},getCallUri:j,getGroupCallUri:function m(p,q,r,s,t,u){__p&&__p();var v;return c("regeneratorRuntime").async(function w(x){__p&&__p();while(1)switch(x.prev=x.next){case 0:v=0;case 1:if(!(v<3)){x.next=14;break}x.prev=2;x.next=5;return c("regeneratorRuntime").awrap(l({conferenceName:p,callID:q,usersToRing:r,hasVideo:s,nonce:t,serverInfoData:u}));case 5:return x.abrupt("return",x.sent);case 8:x.prev=8;x.t0=x["catch"](2);case 11:v++;x.next=1;break;case 14:c("MessengerRTCFunnelLogger").appendAction("use_local_call_uri");return x.abrupt("return",c("XGroupCallController").getURIBuilder().setString("conference_name",p).setInt("call_id",q).setFBIDSet("users_to_ring",r).setBool("has_video",s).setString("server_info_data",u).setString("nonce",t).getURI());case 16:case"end":return x.stop()}},null,this,[[2,8]])},getNonceUri:function p(q,r,s,t,u){var v=arguments.length<=5||arguments[5]===undefined?"":arguments[5],w=c("XVideoCallController").getURIBuilder().setFBID("peer_id",q).setInt("call_id",r).setBool("is_caller",s).setBool("audio_only",t).setString("nonce",u).getURI();return c("FBRTCUtils").isPeerVCEndpoint(q)||c("FBRTCUtils").isCollabTrigger(v)?k(w):w},getWirelessScreenSharingUri:function p(q,r,s){var t=c("XWirelessScreenSharingController").getURIBuilder().setFBID("peer_id",r).setInt("session_id",s).setString("nonce",q).getURI();return k(t)}};f.exports=o}),null);
__d("FBRTCCallUI",["regeneratorRuntime","FBRTCCallSummary","FBRTCCallSummaryStore","FBRTCConstants","FBRTCLogger","FBRTCMessageListener","FBRTCUrlManager","MessengerRTCFunnelLogger","VideoCallTypedLogger","pageID"],(function a(b,c,d,e,f,g){__p&&__p();var h={openGroupCallUI:function i(j,k,l,m,n,o,p){__p&&__p();var q,r,s;return c("regeneratorRuntime").async(function t(u){__p&&__p();while(1)switch(u.prev=u.next){case 0:q=c("FBRTCMessageListener").generateNewNonce();u.next=3;return c("regeneratorRuntime").awrap(c("FBRTCUrlManager").getGroupCallUri(j,k,l,m,q,p));case 3:r=u.sent;c("MessengerRTCFunnelLogger").appendAction("start_load_popup");c("MessengerRTCFunnelLogger").listenCrossWindowAction(q);o.location=r;o.focus&&o.focus();s=new(c("FBRTCCallSummary"))({peerID:-1,callID:k,isCaller:true});s.onCallStarted(n);s.addExtraInfo(c("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,c("pageID"));s.onCallEnded(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,true,"PopupPending");s.save(c("FBRTCCallSummaryStore").getInstance());case 13:case"end":return u.stop()}},null,this)},openGroupCallURI:function i(j){__p&&__p();var k=j.conferenceName,l=j.callID,m=j.hasVideo,n=j.serverInfoData,o=j.trigger,p=j.callSummary,q=j.callWindow,r;return c("regeneratorRuntime").async(function s(t){__p&&__p();while(1)switch(t.prev=t.next){case 0:t.next=2;return c("regeneratorRuntime").awrap(c("FBRTCUrlManager").getGroupCallUri(k,l,[],m,c("FBRTCMessageListener").generateNewNonce(),n));case 2:r=t.sent;q.location=r;q.focus&&q.focus();p.onCallStarted(o);p.addExtraInfo(c("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,c("pageID"));p.onCallEnded(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,true,"PopupPending");p.save(c("FBRTCCallSummaryStore").getInstance());case 9:case"end":return t.stop()}},null,this)},openAsCaller:function i(j,k,l,m,n){new(c("VideoCallTypedLogger"))().setEvent("open_as_caller").log();var o=c("FBRTCMessageListener").generateNewNonce();c("FBRTCLogger").getInstance().logCallAction(j,k,c("FBRTCLogger").CallAction.START_CALL,null,l);var p=new(c("FBRTCCallSummary"))({peerID:j,callID:k,isCaller:true});p.onCallStarted(l);c("MessengerRTCFunnelLogger").listenCrossWindowAction(o);this._open(j,k,true,p,false,m,n,o,l)},openAsCallee:function i(j,k,l,m,n,o){new(c("VideoCallTypedLogger"))().setEvent("open_as_callee").log();this._open(j,k,false,l,m,n,o,c("FBRTCMessageListener").generateNewNonce())},_open:function i(j,k,l,m,n,o,p,q){__p&&__p();var r=arguments.length<=8||arguments[8]===undefined?"":arguments[8];m.addExtraInfo(c("FBRTCLogger").Key.INITIATED_BY_PAGE_ID,c("pageID"));m.onCallEnded(c("FBRTCConstants").CallEndReason.CLIENT_ERROR,false,true,"PopupPending");m.save(c("FBRTCCallSummaryStore").getInstance());if(!p)return;n=c("FBRTCUrlManager").getNonceUri(j,k,l,o,q,r);new(c("VideoCallTypedLogger"))().setEvent("open_popup").log();if(!n)this._setUri(p,j,k,l,o);else{c("MessengerRTCFunnelLogger").appendAction("use_local_call_uri");c("MessengerRTCFunnelLogger").appendAction("start_load_popup");c("FBRTCLogger").getInstance().logCallAction(j,k,c("FBRTCLogger").CallAction.OPEN_POPUP);p.location=n}p.focus&&p.focus()},_setUri:function i(j,k,l,m,n){c("FBRTCUrlManager").getCallUri(k,l,m,n,function(o){c("FBRTCLogger").getInstance().logCallAction(k,l,c("FBRTCLogger").CallAction.OPEN_POPUP);c("MessengerRTCFunnelLogger").appendAction("got_server_call_uri");c("MessengerRTCFunnelLogger").appendAction("start_load_popup");j.location=o},function(){c("FBRTCLogger").getInstance().logCallAction(k,l,c("FBRTCLogger").CallAction.FAILED_GETTING_URI)})}};f.exports=h}),null);