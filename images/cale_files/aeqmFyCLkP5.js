if (self.CavalryLogger) { CavalryLogger.start_js(["s\/j\/k"]); }

__d("MessengerRecorderCommandType",[],(function a(b,c,d,e,f,g){"use strict";var h=Object.freeze({INIT:"init",RECORD:"record",EXPORT_WAV:"export_wav",GET_BUFFER:"get_buffer",CLEAR:"clear"});f.exports=h}),null);
__d("MessengerRecorder",["invariant","MessengerRecorderCommandType","MessengerRecorderWorkerResource","WebWorker"],(function a(b,c,d,e,f,g,h){__p&&__p();var i=window.AudioContext||window.webkitAudioContext;function j(k){"use strict";__p&&__p();this.$MessengerRecorder5=new i();var l=this.$MessengerRecorder5.createMediaStreamSource(k),m=4096,n=l.context;this.$MessengerRecorder2=(n.createScriptProcessor||n.createJavaScriptNode).call(n,m,2,2);this.$MessengerRecorder4=new(c("WebWorker"))(c("MessengerRecorderWorkerResource")).setMessageHandler(function(o){this.$MessengerRecorder1(o)}.bind(this)).execute().postMessage({command:c("MessengerRecorderCommandType").INIT,config:{sampleRate:n.sampleRate}});this.$MessengerRecorder3=false;this.$MessengerRecorder2.onaudioprocess=this.$MessengerRecorder6.bind(this);l.connect(this.$MessengerRecorder2);this.$MessengerRecorder2.connect(n.destination)}j.prototype.$MessengerRecorder6=function(k){"use strict";if(!this.$MessengerRecorder3)return;this.$MessengerRecorder4.postMessage({command:c("MessengerRecorderCommandType").RECORD,buffer:[k.inputBuffer.getChannelData(0),k.inputBuffer.getChannelData(1)]})};j.prototype.record=function(){"use strict";this.$MessengerRecorder3=true};j.prototype.pause=function(){"use strict";this.$MessengerRecorder3=false};j.prototype.clear=function(){"use strict";this.$MessengerRecorder4.postMessage({command:c("MessengerRecorderCommandType").CLEAR})};j.prototype.close=function(){"use strict";this.$MessengerRecorder5!=null||h(0);this.pause();this.clear();this.$MessengerRecorder5.close();this.$MessengerRecorder5=null};j.prototype.getBuffer=function(){"use strict";this.$MessengerRecorder4.postMessage({command:c("MessengerRecorderCommandType").GET_BUFFER})};j.prototype.exportWAV=function(k){"use strict";this.$MessengerRecorder1=k;if(!this.$MessengerRecorder1)throw new Error("Callback not set");this.$MessengerRecorder4.postMessage({command:c("MessengerRecorderCommandType").EXPORT_WAV,type:"audio/wav"})};f.exports=j}),null);
__d("FBRTCStreamWrapper",["mixInEventEmitter","FBRTCUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h=100,i=window.AudioContext||window.webkitAudioContext||window.mozAudioContext,j=void 0;function k(){"use strict";this.$FBRTCStreamWrapper1=true;this.$FBRTCStreamWrapper2=true;this.$FBRTCStreamWrapper3=null;this.$FBRTCStreamWrapper4=null;this.aspectRatio=k.aspectRatios.other;this.videoWidth=0;this.videoHeight=0}k.prototype.setStream=function(l){__p&&__p();var m=arguments.length<=1||arguments[1]===undefined?true:arguments[1];"use strict";var n=this.hasStream();this.stop();this.$FBRTCStreamWrapper3=l;this.$FBRTCStreamWrapper5();this.$FBRTCStreamWrapper6();if(m){this.$FBRTCStreamWrapper3.onaddtrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onremovetrack=this.$FBRTCStreamWrapper7.bind(this);this.$FBRTCStreamWrapper3.onended=this.$FBRTCStreamWrapper8.bind(this);if(n)this.emit("tracksChanged")}};k.prototype.getStreamId=function(){"use strict";return this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.id};k.prototype.getStream=function(){"use strict";return this.$FBRTCStreamWrapper3};k.prototype.hasStream=function(){"use strict";return!!this.$FBRTCStreamWrapper3};k.prototype.stop=function(){"use strict";if(this.$FBRTCStreamWrapper3){k.stopStream(this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper3=null}};k.prototype.hasVideoTracks=function(){"use strict";if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getVideoTracks)return this.$FBRTCStreamWrapper3.getVideoTracks().length>0;return true};k.prototype.hasVideo=function(){"use strict";return this.$FBRTCStreamWrapper2&&this.hasVideoTracks()};k.prototype.hasAudioTracks=function(){"use strict";if(this.$FBRTCStreamWrapper3&&this.$FBRTCStreamWrapper3.getAudioTracks)return this.$FBRTCStreamWrapper3.getAudioTracks().length>0;return true};k.prototype.hasAudio=function(){"use strict";return this.$FBRTCStreamWrapper1&&this.hasAudioTracks()};k.prototype.attachToVideoTag=function(l){"use strict";if(this.$FBRTCStreamWrapper3){this.$FBRTCStreamWrapper4=l;c("FBRTCUtils").attachMediaStream(l,this.$FBRTCStreamWrapper3);this.$FBRTCStreamWrapper9(l)}};k.prototype.getAudioAnalyser=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper10(),m=l.createMediaStreamSource(this.$FBRTCStreamWrapper3),n=l.createAnalyser();n.fftSize=2048;m.connect(n);return n}};k.prototype.$FBRTCStreamWrapper10=function(){"use strict";if(!j)j=new i();return j};k.prototype.toggleMuteAudio=function(){"use strict";if(!this.hasAudioTracks())return;this.$FBRTCStreamWrapper1=!this.$FBRTCStreamWrapper1;this.$FBRTCStreamWrapper5()};k.prototype.$FBRTCStreamWrapper5=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getAudioTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper1}};k.prototype.toggleMuteVideo=function(){"use strict";this.$FBRTCStreamWrapper2=!this.$FBRTCStreamWrapper2;if(this.$FBRTCStreamWrapper2)this.$FBRTCStreamWrapper6();else setTimeout(this.$FBRTCStreamWrapper6.bind(this),500);this.$FBRTCStreamWrapper7()};k.prototype.$FBRTCStreamWrapper6=function(){"use strict";if(this.$FBRTCStreamWrapper3){var l=this.$FBRTCStreamWrapper3.getVideoTracks();for(var m=0;m<l.length;m++)l[m].enabled=this.$FBRTCStreamWrapper2}};k.prototype.setVideoEnabled=function(l){"use strict";this.$FBRTCStreamWrapper2=l;this.$FBRTCStreamWrapper6();this.$FBRTCStreamWrapper7()};k.prototype.$FBRTCStreamWrapper9=function(l){"use strict";if(!this.hasVideo()||l.currentTime>0)this.$FBRTCStreamWrapper11(l);else setTimeout(this.$FBRTCStreamWrapper9.bind(this,l),h)};k.prototype.$FBRTCStreamWrapper12=function(l){"use strict";this.videoWidth=l.videoWidth;this.videoHeight=l.videoHeight;var m=l.videoWidth/l.videoHeight;if(c("FBRTCUtils").aboutEqual(m,16/9))return k.aspectRatios["16:9"];if(c("FBRTCUtils").aboutEqual(m,4/3))return k.aspectRatios["4:3"];return k.aspectRatios.other};k.prototype.$FBRTCStreamWrapper11=function(l){"use strict";if(this.hasVideo())this.aspectRatio=this.$FBRTCStreamWrapper12(l);else this.aspectRatio=k.aspectRatios.other;this.emit("streamStarted")};k.prototype.$FBRTCStreamWrapper8=function(){"use strict";this.emit("streamEnded")};k.prototype.$FBRTCStreamWrapper7=function(event){"use strict";if(this.$FBRTCStreamWrapper13(event))this.attachToVideoTag(this.$FBRTCStreamWrapper4);this.emit("tracksChanged")};k.prototype.$FBRTCStreamWrapper13=function(l){"use strict";return this.$FBRTCStreamWrapper4&&l&&l.type==="addtrack"&&l.track.kind==="video"};k.aspectRatios={"16:9":1,"4:3":2,other:3};c("mixInEventEmitter")(k,{streamStarted:true,streamEnded:true,tracksChanged:true});k.stopStream=function(l){if("active"in l){if(l.active)l.getTracks().forEach(function(m){m.stop()})}else if("stop"in l)l.stop()};f.exports=k}),null);
__d("FBRTCStreamTester",["mixInEventEmitter","FBRTCUtils"],(function a(b,c,d,e,f,g){__p&&__p();var h=100,i=30;function j(k){"use strict";if(!k)k={};this.$FBRTCStreamTester1=k.retries||i;this.$FBRTCStreamTester2=k.testInterval||h;this.$FBRTCStreamTester3=null;this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester5=false}j.prototype.testStream=function(k,l){"use strict";__p&&__p();this.$FBRTCStreamTester3=k;if(!l){this.$FBRTCStreamTester5=true;this.$FBRTCStreamTester4=document.createElement("video");this.$FBRTCStreamTester4.muted=true;c("FBRTCUtils").attachMediaStream(this.$FBRTCStreamTester4,this.$FBRTCStreamTester3);this.$FBRTCStreamTester4.play()}else{this.$FBRTCStreamTester5=false;this.$FBRTCStreamTester4=l}this.$FBRTCStreamTester6(this.$FBRTCStreamTester1)};j.prototype.$FBRTCStreamTester6=function(k){"use strict";__p&&__p();if(this.$FBRTCStreamTester3.getVideoTracks().length===0||this.$FBRTCStreamTester4.currentTime>0){this.$FBRTCStreamTester7();this.emit("streamWorking")}else if(k<1){this.$FBRTCStreamTester7();this.emit("streamBroken")}else setTimeout(this.$FBRTCStreamTester6.bind(this,k-1),this.$FBRTCStreamTester2)};j.prototype.$FBRTCStreamTester7=function(){"use strict";if(this.$FBRTCStreamTester5)this.$FBRTCStreamTester4.pause();this.$FBRTCStreamTester4=null;this.$FBRTCStreamTester3=null};c("mixInEventEmitter")(j,{streamWorking:true,streamBroken:true});f.exports=j}),null);
__d("FBRTCAudioConstraints",["FBRTCConstants","FBRTCVersionDetection"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){var j=arguments.length<=1||arguments[1]===undefined?null:arguments[1];this.streamType=i;this.audioSource=j}h.prototype.getConstraints=function(){if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT&&c("FBRTCVersionDetection").isChrome())return false;if(!this.audioSource)return true;return{optional:[{sourceId:this.audioSource}]}};f.exports=h}),null);
__d("FBRTCVideoConstraints",["FBRTCConstants","RTCConfig","UserAgent"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("FBRTCConstants").RTCConstraints,i=h.FHD_HEIGHT,j=h.HD_HEIGHT,k=h.LQ_HEIGHT,l=h.SD_HEIGHT,m=h.FHD_WIDTH,n=h.HD_WIDTH,o=h.LQ_WIDTH,p=h.SD_WIDTH,q=h.VLQ_FRAME_RATE,r=h.LQ_FRAME_RATE,s=h.FRAME_RATE;function t(u,v){var w=arguments.length<=2||arguments[2]===undefined?null:arguments[2];this.streamType=u;this.videoQuality=v;this.videoSource=w}t.prototype.getConstraints=function(){__p&&__p();if(this.streamType===c("FBRTCConstants").StreamType.AUDIO_ONLY)return false;if(this.streamType===c("FBRTCConstants").StreamType.SCREEN_CONTENT){if(this.videoSource){if(c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO_STREAM_SIZE)return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource},optional:[{minHeight:l},{maxHeight:i},{minFrameRate:q},{maxFrameRate:s}]};var u={width:m,height:i,frameRate:s},v=this.$FBRTCVideoConstraints1(u),w=v.width,x=v.height,y=v.frameRate;return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:this.videoSource,minHeight:x,maxHeight:x,minWidth:w,maxWidth:w,minFrameRate:q,maxFrameRate:y}}}return false}var z=this.$FBRTCVideoConstraints1(c("RTCConfig").CollaborationCallQuality.videoToRoom),A=z.width,B=z.height,C=z.frameRate;if(this.shouldUseNewMozAPI())return{height:{min:k,max:j,ideal:B},width:{min:320,max:1280,ideal:B*16/9},frameRate:{min:10,max:30,ideal:C}};var D={mandatory:{},optional:[{minHeight:B},{maxHeight:B},{minFrameRate:C},{maxFrameRate:C},{googLeakyBucket:true}]};if(this.videoSource)D.optional=D.optional.concat({sourceId:this.videoSource});if(this.videoQuality===c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO)D.optional=D.optional.concat({minWidth:A},{maxWidth:A});return D};t.prototype.$FBRTCVideoConstraints1=function(u){var v=arguments.length<=1||arguments[1]===undefined?{width:p,height:l,frameRate:s}:arguments[1];switch(this.videoQuality){case c("FBRTCConstants").VideoQuality.HD_VIDEO:return{width:n,height:j,frameRate:s};case c("FBRTCConstants").VideoQuality.LQ_VIDEO:return{width:o,height:k,frameRate:r};case c("FBRTCConstants").VideoQuality.SD_VIDEO:return{width:p,height:l,frameRate:s};case c("FBRTCConstants").VideoQuality.CUSTOM_VIDEO:return u;default:return v}};t.prototype.shouldUseNewMozAPI=function(){return!!navigator.mediaDevices&&c("UserAgent").isBrowser("Firefox >= 38")};f.exports=t}),null);
__d("RTCMediaDevices",["invariant","Promise","RTCOnDeviceChangePoller"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=navigator.mediaDevices&&typeof navigator.mediaDevices.enumerateDevices==="function",j=window.MediaStreamTrack&&window.MediaStreamTrack.getSources==="function",k=1e3,l=void 0,m={addEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(!l)l=new(c("RTCOnDeviceChangePoller"))(k);l.add(q);return}var r=navigator,s=r.mediaDevices;if(s&&"addEventListener"in s)s.addEventListener(p,q)},removeEventListener:function o(p,q){if(p==="devicechange"&&c("RTCOnDeviceChangePoller").isNeeded()){if(l)l.remove(q);return}var r=navigator,s=r.mediaDevices;if(s&&"removeEventListener"in s)s.removeEventListener(p,q)},isSupported:function o(p){switch(p){case"enumerateDevices":return i||j;default:return Boolean(navigator.mediaDevices)}},enumerateDevices:function o(){if(i){navigator.mediaDevices||h(0);return c("Promise").resolve(navigator.mediaDevices.enumerateDevices())}else if(j)return new(c("Promise"))(function(p){return window.MediaStreamTrack.getSources(p)}).then(n);return c("Promise").reject(new Error("enumerateDevices() not supported"))},filterDevicesOfKind:function o(p,q){return p.filter(function(r){return r.kind===q})}};function n(o){return o.map(function(p){var q=p.id,r=p.kind,s=p.label;return{deviceId:q,groupId:"",kind:r==="video"?"videoinput":"audioinput",label:s}})}f.exports=m}),null);
__d("RTCOnDeviceChangePoller",["Promise","RTCMediaDevices"],(function a(b,c,d,e,f,g){__p&&__p();h.isNeeded=function(){"use strict";var i=navigator,j=i.mediaDevices;if(!c("RTCMediaDevices").isSupported("enumerateDevices")||j&&"ondevicechange"in j)return false;return true};function h(i){"use strict";__p&&__p();this.$RTCOnDeviceChangePoller1=[];this.$RTCOnDeviceChangePoller2="";this.$RTCOnDeviceChangePoller4=null;this.$RTCOnDeviceChangePoller7=function(){__p&&__p();c("RTCMediaDevices").enumerateDevices().then(function(j){__p&&__p();var k=j.map(function(r){return r.deviceId+":"+r.label+":"+r.groupId}).sort().join("~");if(k===this.$RTCOnDeviceChangePoller2)return;this.$RTCOnDeviceChangePoller2=k;for(var l=this.$RTCOnDeviceChangePoller1,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var o;if(m){if(n>=l.length)break;o=l[n++]}else{n=l.next();if(n.done)break;o=n.value}var p=o;try{p()}catch(q){}}}.bind(this))["catch"](function(j){return c("Promise").resolve()}).then(function(){this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,this.$RTCOnDeviceChangePoller3)}.bind(this))["catch"](function(j){})}.bind(this);this.$RTCOnDeviceChangePoller3=i}h.prototype.add=function(i){"use strict";this.$RTCOnDeviceChangePoller1.push(i);this.$RTCOnDeviceChangePoller5()};h.prototype.remove=function(i){"use strict";this.$RTCOnDeviceChangePoller1=this.$RTCOnDeviceChangePoller1.filter(function(j){return j!==i});this.$RTCOnDeviceChangePoller6()};h.prototype.$RTCOnDeviceChangePoller5=function(){"use strict";if(this.$RTCOnDeviceChangePoller4!==null)return;this.$RTCOnDeviceChangePoller4=setTimeout(this.$RTCOnDeviceChangePoller7,0)};h.prototype.$RTCOnDeviceChangePoller6=function(){"use strict";if(this.$RTCOnDeviceChangePoller1.length>0)return;if(this.$RTCOnDeviceChangePoller4!==null){clearTimeout(this.$RTCOnDeviceChangePoller4);this.$RTCOnDeviceChangePoller4=null}};f.exports=h}),null);
__d("FBRTCUserMediaRequest",["Promise","FBRTCAudioConstraints","FBRTCConstants","FBRTCVideoConstraints","RTCMediaDevices"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){var j=arguments.length<=1||arguments[1]===undefined?c("FBRTCConstants").VideoQuality.SD_VIDEO:arguments[1],k=arguments[2];this.streamType=i;this.videoQuality=j;this.isAudioOnly=k;this.audioSource=null;this.videoSource=null}h.prototype.$FBRTCUserMediaRequest1=function(){__p&&__p();var i=new(c("FBRTCAudioConstraints"))(this.streamType,this.audioSource),j=new(c("FBRTCVideoConstraints"))(this.streamType,this.videoQuality,this.videoSource),k={audio:i.getConstraints(),video:j.getConstraints()};if(!this.isAudioOnly)return c("Promise").resolve(k);return c("RTCMediaDevices").enumerateDevices().then(function(l){if(l.every(function(m){var n=m.kind;return n!=="videoinput"}))k.video=false;return k})["catch"](function(){return c("Promise").resolve(k)})};h.prototype.request=function(){__p&&__p();return this.$FBRTCUserMediaRequest1().then(function(i){__p&&__p();if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(i);return new(c("Promise"))(function(j,k){if(navigator.getUserMedia)navigator.getUserMedia(i,j,k);else if(navigator.webkitGetUserMedia)navigator.webkitGetUserMedia(i,j,k);else if(navigator.mozGetUserMedia)navigator.mozGetUserMedia(i,j,k);else k("getUserMedia not supported")})})};f.exports=h}),null);
__d("FBRTCUserMedia",["FBRTCConstants","FBRTCLogger","FBRTCStreamTester","FBRTCStreamWrapper","FBRTCUserMediaRequest","MessengerRTCFunnelLogger","UserMediaRequestError","mixInEventEmitter"],(function a(b,c,d,e,f,g){__p&&__p();var h={_localStream:null,_accessGranted:false,_pendingRequest:null,_failedVideoSources:[],_failedAudioSources:[],requestUserMedia:function i(j,k,l,m,n){if(this._localStream&&!l&&!m)this.emit("streamReady",this._localStream);else{this._startRequestListeners();this._pendingRequest=new(c("FBRTCUserMediaRequest"))(j,k,n);this._pendingRequest.audioSource=l;this._pendingRequest.videoSource=m;this._request()}},_request:function i(){if(this._pendingRequest){this._pendingRequest.request().then(function(j){return this._onRequestSuccess(j)}.bind(this),function(j){return this._onRequestFailure(c("UserMediaRequestError").createFromNative(j))}.bind(this));c("MessengerRTCFunnelLogger").appendAction("user_media_requested")}},end:function i(){this._stopEventListeners();if(this._localStream){c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=null}},_startRequestListeners:function i(){if(navigator.mozGetUserMedia){this._evListener=this._onMediaPromptHidden.bind(this);document.addEventListener("mousedown",this._evListener);document.addEventListener("focus",this._evListener)}},_stopEventListeners:function i(){if(navigator.mozGetUserMedia){if(this._promptTimeout)clearTimeout(this._promptTimeout);document.removeEventListener("mousedown",this._evListener);document.removeEventListener("focus",this._evListener)}},_onMediaPromptHidden:function i(){this._promptTimeout=setTimeout(function(){if(!this._accessGranted&&this._pendingRequest)this._request()}.bind(this),1500)},_onRequestSuccess:function i(j){__p&&__p();this._stopEventListeners();c("MessengerRTCFunnelLogger").appendAction("user_media_succeeded");if(!this._accessGranted){this._accessGranted=true;this.emit("accessGranted")}j.videoMediaSourceId=this._pendingRequest.videoSource;j.audioMediaSourceId=this._pendingRequest.audioSource;var k=new(c("FBRTCStreamTester"))();k.addListener("streamWorking",function(){this._pendingRequest=null;if(this._localStream&&this._localStream!==j)c("FBRTCStreamWrapper").stopStream(this._localStream);this._localStream=j;this.emit("streamReady",this._localStream)}.bind(this));k.addListener("streamBroken",function(){c("FBRTCStreamWrapper").stopStream(j);this._onRequestFailure(new(c("UserMediaRequestError"))("StreamFailedToStart","",""))}.bind(this));k.testStream(j)},_onRequestFailure:function i(j){__p&&__p();this._stopEventListeners();var k=j.getName();c("MessengerRTCFunnelLogger").appendAction("user_media_rejected",k);if(this._shouldRetryRequest(j,this._pendingRequest)){this._configureRequestForRetry(this._pendingRequest,j);return}if(j.isRecoverableError()){c("FBRTCLogger").getInstance().logErrorWithoutID("Invalid state while requesting user media");return}this._pendingRequest=null;if(k==="NotAllowedError")this.emit("accessDenied");else{c("FBRTCLogger").getInstance().logErrorWithoutID("getUserMedia error: "+k);this.emit("accessFailed",j.getEndCallSubReason())}},_shouldRetryRequest:function i(j,k){return k.streamType!==c("FBRTCConstants").StreamType.AUDIO_ONLY&&(j.getNativeErrorName()==="DevicesNotFoundError"||j.getNativeErrorName()==="StreamFailedToStart")},_configureRequestForRetry:function i(j,k){__p&&__p();if(k.getNativeErrorName()==="StreamFailedToStart"&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources){if(j.videoSource)this._failedVideoSources.push(j.videoSource);window.MediaStreamTrack.getSources(function(l){__p&&__p();for(var m=0;m<l.length;m++){var n=l[m];if(n.kind==="video"&&this._failedVideoSources.indexOf(n.id)===-1){j.videoSource=n.id;this._request();return}}j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}.bind(this))}else{j.streamType=c("FBRTCConstants").StreamType.AUDIO_ONLY;this._request()}}};c("mixInEventEmitter")(h,{streamReady:true,accessGranted:true,accessDenied:true,accessFailed:true});f.exports=h}),null);
__d("sumOfArray",[],(function a(b,c,d,e,f,g){function h(i){var j=0,k=i.length;for(var l=0;l<k;++l)j+=i[l];return j}f.exports=h}),null);
__d("MessengerVoiceClipFlyoutReact.bs",["cx","fbt","bs_block","bs_curry","React","LinkReact.bs","bs_pervasives","sumOfArray","ReasonReact.bs","FBRTCConstants","FBRTCUserMedia","MessengerRecorder","FBRTCStreamWrapper","cancelAnimationFrame","requestAnimationFrame"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j=i._("Voice Clip"),k=i._("Cancel"),l=i._("Record"),m=i._("Send");function n(G){var H=new Uint8Array(2048);G.getByteFrequencyData(H);var I=c("sumOfArray")(H)/2048|0,J=+(I>100),K=J!==0?1:I/100;return 228*K+72}function o(G){var H=G/60|0,I=G%60,J=+(I<10),K=J!==0?"0"+c("bs_pervasives").string_of_int(I):c("bs_pervasives").string_of_int(I);return""+(String(H)+(":"+(String(K)+"")))}var p=c("ReasonReact.bs").statelessComponent("MessengerVoiceClipRecordButton");function q(G,H,z,B,I){var J=p.slice();J[9]=function(){return c("React").createElement("div",undefined,c("React").createElement("div",{className:"_3z54",style:{height:""+(String(G)+"px"),width:""+(String(G)+"px")}}),c("ReasonReact.bs").element(0,0,c("LinkReact.bs").make(0,0,0,0,0,0,0,0,[H!==0?z:B],0,0,["button"],0,0,0,[H!==0?m:l],c("React").createElement("div",{className:"_3z55"},c("React").createElement("span",{className:"_3z56"},H!==0?"":l)))))};return J}var r=[p,q],s=c("ReasonReact.bs").statelessComponent("MessengerVoiceClipCancelButton");function t(G,A,H){var I=s.slice();I[9]=function(){if(G!==0)return c("ReasonReact.bs").element(0,0,c("LinkReact.bs").make(0,["_3z58"],0,0,0,0,0,0,[A],0,0,["button"],0,0,0,[k],k));else return null};return I}var u=[s,t],v=c("ReasonReact.bs").reducerComponent("MessengerVoiceClipFlyout");function w(){return[0,0,0,0,[0],0]}function x(G,H){var I=H[3],J=c("requestAnimationFrame")(function(){return c("bs_curry")._1(I,c("bs_block").__(1,[G]))});H[1][4][0]=[J];return 0}function y(G){__p&&__p();var H=G[1],I=H[4][0];if(I)c("cancelAnimationFrame")(I[0]);var J=H[3];if(J)clearInterval(J[0]);var K=H[0];if(K)K[0].clear();c("FBRTCUserMedia").end();c("FBRTCUserMedia").removeAllListeners();return c("bs_curry")._1(G[3],1)}function z(G,H,I){var J=I[1][0];if(J){var K=J[0];K.pause();K.exportWAV(G)}c("FBRTCUserMedia").end();c("FBRTCUserMedia").removeAllListeners();return y(I)}function A(G,H,I){y(I);return c("bs_curry")._1(G,0)}function B(G,H){__p&&__p();var I=H[3];c("FBRTCUserMedia").addListener("accessDenied",function(){return 0});c("FBRTCUserMedia").addListener("accessFailed",function(){return 0});c("FBRTCUserMedia").addListener("streamReady",function(J){var K=new(c("FBRTCStreamWrapper"))();K.setStream(J);var L=K.getAudioAnalyser(),M=new(c("MessengerRecorder"))(J);M.record();var N=setInterval(function(){return c("bs_curry")._1(I,0)},1e3);return c("bs_curry")._1(I,c("bs_block").__(0,[M,N,L]))});c("FBRTCUserMedia").requestUserMedia(c("FBRTCConstants").StreamType.AUDIO_ONLY,c("FBRTCConstants").VideoQuality.NO_VIDEO);return 0}function C(G,H,I){__p&&__p();var J=v.slice();J[6]=function(K){y(K);var L=K[1][0];if(L){L[0].close();return 0}else return 0};J[9]=function(K){var L=K[1],M=K[0];return c("React").cloneElement(c("React").createElement("div",{className:"_3z51"+(L[1]?" _3z52":""),role:"dialog"}),{"aria-label":j},c("ReasonReact.bs").element(0,0,q(L[5],L[1],c("bs_curry")._1(M,function(K,N){return z(H,K,N)}),c("bs_curry")._1(M,B),[])),c("React").createElement("div",{className:"_3z53"},o(L[2])),c("ReasonReact.bs").element(0,0,t(L[1],c("bs_curry")._1(M,function(I,K){y(K);return c("bs_curry")._1(G,0)}),[])))};J[10]=w;J[12]=function(K,L){__p&&__p();if(typeof K==="number")if(K)return c("bs_block").__(0,[[0,0,0,0,[0],0]]);else{var J=L.slice();return c("bs_block").__(0,[(J[2]=L[2]+1|0,J)])}else if(K.tag){var M=K[0],N=L.slice();return c("bs_block").__(3,[(N[5]=n(M),N),function(P){return x(M,P)}])}else{var O=K[2];return c("bs_block").__(3,[[[K[0]],1,0,[K[1]],L[4],L[5]],function(P){return x(O,P)}])}};return J}var D=c("ReasonReact.bs").wrapReasonForJs(v,function(G){return C(G.onCancel,G.onStopAndGetVoiceClip,[])}),E=300,F=72;g.maxWidth=E;g.minWidth=F;g.label=j;g.cancelString=k;g.recordString=l;g.sendString=m;g.normalizeVolume=n;g.formatTime=o;g.RecordButton=r;g.CancelButton=u;g.component=v;g.getInitialState=w;g.animate=x;g.cleanup=y;g.stopRecordingAndCreateClip=z;g.cancelRecording=A;g.startRecording=B;g.make=C;g.jsComponent=D}),null);