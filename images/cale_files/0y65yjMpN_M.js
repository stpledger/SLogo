if (self.CavalryLogger) { CavalryLogger.start_js(["3N+wN"]); }

__d("MessengerInitialDataTransformer.bs",["bs_array","bs_caml_array","MercuryThreadlistConstants","MessengerGraphQLThreadlistFetcher.bs","MessengerServerPayloadTransformer.bs"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){__p&&__p();var j=i.viewer,k=i.is_page,l=i.additional_participant,m;if(l==null)m=[];else{var n=[];c("bs_array").iter(function(B){if(B==null)return 0;else{n.push(c("MessengerServerPayloadTransformer.bs").transformParticipant(B));return 0}},l.nodes);m=n}var o=i.thread_list,p=o==null?null:c("MessengerGraphQLThreadlistFetcher.bs").transform(j,[{limit:c("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1|0,folder:"inbox",timestamp:null,offset:0,filter:null}],+k,[o]),q=i.work_top_named_threads,r=q==null?null:c("MessengerGraphQLThreadlistFetcher.bs").transform(j,[{limit:c("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1|0,folder:"inbox",timestamp:null,offset:0,filter:null}],0,[q]),s=i.current_thread,t;if(s==null)t=null;else{var u=s.message_thread;t=u==null?null:c("MessengerServerPayloadTransformer.bs").transformThread(j,u,+k)}var v=p==null?[[],[],{},[],[]]:[p.ordered_threadlists,p.threads,p.roger,p.participants,p.delivery_receipts],w=v[1],x=r==null?[]:r.threads,y=i.thread_key,z=y==null?w.filter(function(B){return+(B.unread_count===0)}):[],A=z.length?c("bs_caml_array").caml_array_get(z,0).thread_fbid:null;if(!(t==null))w.push(t);return[{ordered_threadlists:v[0],threads:w,roger:v[2],participants:v[3].concat(m),delivery_receipts:v[4],payload_source:"server_initial_data",work_top_named_threads:x},A]}g.transform=h}),null);