if (self.CavalryLogger) { CavalryLogger.start_js(["\/nCUy"]); }

__d("MessengerPhotoViewBottomBar.react",["cx","React"],(function a(b,c,d,e,f,g,h){"use strict";var i=function i(j){return c("React").createElement("div",{className:"_51an _50-m _16zz"},j.children)};f.exports=i}),null);
__d("MessengerPhotoViewHScroll.react",["cx","Animation","MessengerSharedPhoto.react","React","SphericalPhotoUtils"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=c("SphericalPhotoUtils").getThumbnailsFromPhotoEncodings,l=c("React").PropTypes,m=200,n=80;i=babelHelpers.inherits(o,c("React").Component);j=i&&i.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=j.constructor).call.apply(p,[this].concat(s)),this.$MessengerPhotoViewHScroll1=null,q}o.prototype.componentDidMount=function(){this.$MessengerPhotoViewHScroll2()};o.prototype.componentDidUpdate=function(){this.$MessengerPhotoViewHScroll2()};o.prototype.componentWillUnmount=function(){this.$MessengerPhotoViewHScroll1&&this.$MessengerPhotoViewHScroll1.stop();this.$MessengerPhotoViewHScroll1=null};o.prototype.render=function(){__p&&__p();var p=this.props.sharedPhotos,q=p.reduce(function(s,t){var u=t.node.image1===null?t.node.image:t.node.image1,v=t.node.photo_encodings?t.node.photo_encodings.length!==0:false,w=u.uri;if(v){var x=k(t.node.photo_encodings),y=x.smallThumbnail;w=y||w}if(u)s.push(c("React").createElement("div",{className:"_4dy9",key:t.node.legacy_attachment_id},c("React").createElement(c("MessengerSharedPhoto.react"),{className:"_42rl"+(this.props.photoID!==t.node.legacy_attachment_id?" _q1a":""),fbid:t.node.legacy_attachment_id,onClick:this.props.onScroll,uri:w,isSpherical:v})));return s}.bind(this),[]),r=(this.props.width-n)/2;return c("React").createElement("div",{className:"_463g"},c("React").createElement("div",{className:"_463h",ref:"childContainer"},c("React").createElement("div",{className:"_463j",style:{paddingLeft:r,paddingRight:r},ref:"scrollable"},q)))};o.prototype.$MessengerPhotoViewHScroll2=function(){var p=this.refs.childContainer?this.refs.childContainer.scrollLeft:0,q=this.props.sharedPhotos.findIndex(function(s){return s.node.legacy_attachment_id===this.props.photoID}.bind(this)),r=q*n;if(!this.$MessengerPhotoViewHScroll1)this.$MessengerPhotoViewHScroll1=new(c("Animation"))(this.refs.childContainer);this.$MessengerPhotoViewHScroll1.from("scrollLeft",p).to("scrollLeft",r).duration(m).go()};f.exports=o}),null);
__d("MessengerPhotoViewHeader.react",["cx","fbt","MessagingForwardingButtonNUX.react","MessengerActions","MessengerPhotoInfoDialogContainer.react","React","SpotlightViewerBottomBarLink","MessengerPhotoViewCloseLink.react"],(function a(b,c,d,e,f,g,h,i){"use strict";__p&&__p();var j,k,l=c("React").PropTypes;j=babelHelpers.inherits(m,c("React").PureComponent);k=j&&j.prototype;function m(){var n,o;for(var p=arguments.length,q=Array(p),r=0;r<p;r++)q[r]=arguments[r];return o=(n=k.constructor).call.apply(n,[this].concat(q)),this.$MessengerPhotoViewHeader3=function(){if(this.refs.forwardNUX)this.refs.forwardNUX.close();this.props.showForwardDialog&&this.props.showForwardDialog()}.bind(this),o}m.prototype.render=function(){return c("React").createElement("div",{className:"_51an _50-m _3c1i _5l-3",role:"banner"},this.$MessengerPhotoViewHeader1(),this.$MessengerPhotoViewHeader2())};m.prototype.$MessengerPhotoViewHeader2=function(){return c("React").createElement(c("MessengerPhotoViewCloseLink.react"),{onClick:this.props.onClose})};m.prototype.$MessengerPhotoViewHeader1=function(){var n=void 0,o=void 0;if(!this.props.disableForward){n=c("React").createElement(c("SpotlightViewerBottomBarLink"),{className:"_3c1o",onClick:this.$MessengerPhotoViewHeader3,ref:"forwardButton"},c("React").createElement("div",{className:"_2msr _3oo2"}),i._("Forward"));o=c("React").createElement(c("MessagingForwardingButtonNUX.react"),{contextRef:function(){return this.refs.forwardButton}.bind(this),ref:"forwardNUX"},i._("Send this image to other people in separate messages."))}return c("React").createElement("div",{key:"buttonsContainer",ref:"buttons"},c("React").createElement(c("SpotlightViewerBottomBarLink"),{ajaxify:this.props.url,className:"_3c1o",rel:"async"},c("React").createElement("div",{className:"_3ooo _2msr"}),i._("Download")),n,o,c("React").createElement(c("SpotlightViewerBottomBarLink"),{className:"_3c1o",href:"#",onClick:this.props.openInfo,ref:"moreInfo"},c("React").createElement("div",{className:"_3c1k _2msr"}),i._("Info")))};m.propTypes={disableForward:l.bool,onClose:l.func,openInfo:l.func,photoID:l.string,showForwardDialog:l.func,url:l.object};f.exports=m}),null);
__d("MessagesViewerSetID",[],(function a(b,c,d,e,f,g){f.exports=Object.freeze({MESSAGES:"messages",MESSAGES_VIEW_ALL_IN_THREAD:"messages:view_all_in_thread"})}),null);
__d("MessagesViewer",["AsyncRequest","DOM","MessagesViewerSetID","PhotoStore","React","ReactDOM","emptyFunction","ge"],(function a(b,c,d,e,f,g){__p&&__p();var h={renderSpotlight:function j(k,l,m,n){__p&&__p();var o=k.setID;if(!o)o=c("MessagesViewerSetID").MESSAGES;i(c("React").createElement(m,{actorid:k.actorid,dimensions:[k.dimensions],disablepaging:k.disablePaging,disableForward:k.disableForward,forwardDialogComponent:n,open:true,photoid:k.fbid,reverse:false,rootClassName:k.rootClassName,setid:o,snapToPhoto:k.snapToPhoto,thumbsrc:k.src}));if(!c("PhotoStore").hasBeenCreated(o)&&k.endpoint){var p=new(c("AsyncRequest"))(k.endpoint);if(l)p.setRelativeTo(l);p.send()}},renderVideo:function j(k){i(k)}};function i(j){var k=c("ge")("messages_viewer");if(!k){k=c("DOM").create("div",{id:"messages_viewer"});document.body.appendChild(k)}c("ReactDOM").render(j,k,function(){this.subscribeOnce("close",function(){c("ReactDOM").unmountComponentAtNode(k)})})}f.exports=h}),null);
__d("SpotlightMessengerSharedMediaViewer.react",["csx","cx","fbt","invariant","ActorURI","BootloadedComponent.react","JSResource","MessengerPhotoViewHScroll.react","Event","KeyEventController","MessengerForwardAttachmentDialogReact.bs","MessengerPhotoInfoDialogContainer.react","MessengerPhotoViewHeader.react","MessengerSharedMediaActions","MessengerVideoPlayer.react","Parent","PhotoUtils","React","SpotlightViewer","SpotlightViewerImage","SpotlightMessagesViewerPagers.react","SpotlightViewport","SubscriptionsHandler","Vector","XMessagingPhotoDownloadController","MessengerPhotoViewBottomBar.react"],(function a(b,c,d,e,f,g,h,i,j,k){"use strict";__p&&__p();var l,m,n=c("MessengerForwardAttachmentDialogReact.bs").jsComponent,o=c("React").PropTypes,p=88,q=80,r=30,s="_4-og";l=babelHelpers.inherits(t,c("React").Component);m=l&&l.prototype;function t(){__p&&__p();var u,v;for(var w=arguments.length,x=Array(w),y=0;y<w;y++)x[y]=arguments[y];return v=(u=m.constructor).call.apply(u,[this].concat(x)),this.$SpotlightMessengerSharedMediaViewer1=undefined,this.$SpotlightMessengerSharedMediaViewer2=[],this.state={photoData:null,showForward:false,showInfo:false,stageDimensions:new(c("Vector"))()},this.$SpotlightMessengerSharedMediaViewer14=function(z){if(!this.props.sharedMedia)return;var A=this.props.sharedMedia.findIndex(function(C){return C.node.legacy_attachment_id===z});if(A<0)return;var B=this.props.sharedMedia[A];this.setState({photoData:B});this.$SpotlightMessengerSharedMediaViewer17(A)}.bind(this),this.$SpotlightMessengerSharedMediaViewer4=function(z,event){__p&&__p();if(this.state.photoData==null)return;var A=this.state.photoData;if(event&&!!c("Parent").bySelector(event.target,"._170l"))return;if(event&&event.target instanceof HTMLElement&&event.target.className===s)this.$SpotlightMessengerSharedMediaViewer7();var B=this.props.sharedMedia.findIndex(function(D){return D.node.legacy_attachment_id===A.node.legacy_attachment_id});if(B<0||B===this.props.sharedMedia.length-1&&!this.props.hasNextPage&&z)return;if(B===0&&!z){c("MessengerSharedMediaActions").loadMoreLatest(this.props.threadID,this.props.sharedMedia[0].cursor,r);return}var C=z?this.props.sharedMedia[B+1]:this.props.sharedMedia[B-1];this.setState({photoData:C});this.$SpotlightMessengerSharedMediaViewer17(B)}.bind(this),this.$SpotlightMessengerSharedMediaViewer7=function(){if(this.props.photoID===null)return;this.setState({photoData:null});this.props.onClosePhotoView()}.bind(this),this.$SpotlightMessengerSharedMediaViewer12=function(){this.setState({showForward:true})}.bind(this),this.$SpotlightMessengerSharedMediaViewer15=function(){this.setState({showForward:false})}.bind(this),this.$SpotlightMessengerSharedMediaViewer11=function(){this.setState({showInfo:true})}.bind(this),this.$SpotlightMessengerSharedMediaViewer16=function(){this.setState({showInfo:false})}.bind(this),v}t.prototype.componentDidMount=function(){__p&&__p();var u=this.props.sharedMedia.find(function(v){return v.node.legacy_attachment_id===this.props.photoID}.bind(this));this.setState({photoData:u,stageDimensions:this.$SpotlightMessengerSharedMediaViewer3()});this.$SpotlightMessengerSharedMediaViewer1=new(c("SubscriptionsHandler"))();this.$SpotlightMessengerSharedMediaViewer1.addSubscriptions(c("Event").listen(window,"resize",function(){this.setState({stageDimensions:this.$SpotlightMessengerSharedMediaViewer3()})}.bind(this)),c("KeyEventController").registerKey("LEFT",function(){this.$SpotlightMessengerSharedMediaViewer4(false);return false}.bind(this)),c("KeyEventController").registerKey("RIGHT",function(){this.$SpotlightMessengerSharedMediaViewer4(true);return false}.bind(this)))};t.prototype.componentWillUnmount=function(){this.$SpotlightMessengerSharedMediaViewer1&&this.$SpotlightMessengerSharedMediaViewer1.release();this.$SpotlightMessengerSharedMediaViewer1=null;this.$SpotlightMessengerSharedMediaViewer2.forEach(function(u){return u.abandon()})};t.prototype.render=function(){var u=this.$SpotlightMessengerSharedMediaViewer5(),v=this.state.stageDimensions,w=this.props.useloadingindicator&&!this.state.photoData;if(this.state.photoData==null)return null;var x=this.props.sharedMedia.findIndex(function(u){this.state.photoData!=null||k(0);return u.node.id===this.state.photoData.node.id}.bind(this)),y=c("React").createElement("div",null,this.$SpotlightMessengerSharedMediaViewer6(),this.props.disablepaging?null:c("React").createElement(c("SpotlightMessagesViewerPagers.react"),{disablePrevArrow:x<=0&&!this.props.hasPrevPage,disableNextArrow:!this.props.hasNextPage&&x>=this.props.sharedMedia.length-1}));return c("React").createElement("span",null,c("React").createElement(c("SpotlightViewer"),{className:"_53vs",onHide:this.$SpotlightMessengerSharedMediaViewer7,open:this.props.photoID!==null,ref:"spotlightViewer",rootClassName:this.props.rootClassName},c("React").createElement(c("SpotlightViewport"),{active:false,fadeInNOut:true,media:u,onClick:this.$SpotlightMessengerSharedMediaViewer4,ref:"viewport",showLoadingIndicator:w,stageDimensions:v,useWidth:true},y),this.$SpotlightMessengerSharedMediaViewer8()),this.$SpotlightMessengerSharedMediaViewer9(),this.$SpotlightMessengerSharedMediaViewer10())};t.prototype.$SpotlightMessengerSharedMediaViewer6=function(){if(!this.state.photoData)return null;var u=this.state.photoData.node.legacy_attachment_id,v=c("XMessagingPhotoDownloadController").getURIBuilder().setString("photo_id",u).getURI();if(this.props.actorid)v=c("ActorURI").create(v,this.props.actorid);return c("React").createElement(c("MessengerPhotoViewHeader.react"),{disableForward:this.props.disableForward,onClose:this.$SpotlightMessengerSharedMediaViewer7,openInfo:this.$SpotlightMessengerSharedMediaViewer11,photoID:this.props.photoID,ref:"photoviewheader",showForwardDialog:this.$SpotlightMessengerSharedMediaViewer12,url:v})};t.prototype.$SpotlightMessengerSharedMediaViewer13=function(u){return u?Math.ceil(u/q):r};t.prototype.$SpotlightMessengerSharedMediaViewer8=function(){if(!this.state.photoData)return null;var u=this.state.photoData,v=c("React").createElement("button",{className:"_2n5b",onClick:function(){return this.props.openAlbum(u.node.legacy_attachment_id)}.bind(this),type:"button"},c("React").createElement("div",{className:"_3por"}));return c("React").createElement(c("MessengerPhotoViewBottomBar.react"),null,c("React").createElement(c("MessengerPhotoViewHScroll.react"),{onScroll:this.$SpotlightMessengerSharedMediaViewer14,photoID:u.node.legacy_attachment_id,sharedPhotos:this.props.sharedMedia,width:this.state.stageDimensions.x}),v)};t.prototype.$SpotlightMessengerSharedMediaViewer9=function(){if(!this.state.photoData||this.props.disableForward)return null;var u=j._("Forward in separate messages");return c("React").createElement(n,{attachmentID:this.state.photoData.node.legacy_attachment_id,onClose:this.$SpotlightMessengerSharedMediaViewer15,shown:this.state.showForward,title:u})};t.prototype.$SpotlightMessengerSharedMediaViewer10=function(){return this.state.showInfo?c("React").createElement(c("MessengerPhotoInfoDialogContainer.react"),{closeInfo:this.$SpotlightMessengerSharedMediaViewer16,infoOpen:this.state.showInfo,photoID:this.state.photoData.node.id}):c("React").createElement("xhp",null)};t.prototype.$SpotlightMessengerSharedMediaViewer17=function(u){var v=this.$SpotlightMessengerSharedMediaViewer13(this.state.stageDimensions.x),w=this.props.sharedMedia;if(u<=v/2){c("MessengerSharedMediaActions").loadMoreLatest(this.props.threadID,w[0].cursor,v);if(w.length<v&&this.props.hasNextPage)c("MessengerSharedMediaActions").loadMorePrevious(this.props.threadID,w[w.length-1].cursor,v)}else if(u>=w.length-v/2&&this.props.hasNextPage)c("MessengerSharedMediaActions").loadMorePrevious(this.props.threadID,w[w.length-1].cursor,v)};t.prototype.$SpotlightMessengerSharedMediaViewer3=function(){var u=new(c("Vector"))(c("Vector").getViewportDimensions().x,c("Vector").getViewportDimensions().y-p);return u};t.prototype.$SpotlightMessengerSharedMediaViewer5=function(){__p&&__p();if(this.state.photoData&&this.state.photoData.node){var u=this.state.photoData.node;if(u.__typename&&u.__typename==="MessageVideo")return this.$SpotlightMessengerSharedMediaViewer18();var v=this.state.stageDimensions,w=this.$SpotlightMessengerSharedMediaViewer19(u,v);if(!w)return null;if(u.photo_encodings&&u.photo_encodings.length!==0)return this.$SpotlightMessengerSharedMediaViewer20(u.legacy_attachment_id,w,u.photo_encodings,v);var x=t.getImageDimensionsForStage(new(c("Vector"))(w.width,w.height),v);return this.$SpotlightMessengerSharedMediaViewer21(w,x)}else return null};t.prototype.$SpotlightMessengerSharedMediaViewer18=function(){if(this.state.photoData)return c("React").createElement(c("MessengerVideoPlayer.react"),{isVisible:true,isOnStage:true,videoData:this.state.photoData.node,stageDimensions:this.state.stageDimensions});return null};t.prototype.$SpotlightMessengerSharedMediaViewer21=function(u,v){return c("React").createElement(c("SpotlightViewerImage"),{dimensions:v,ref:"image",src:u.uri})};t.prototype.$SpotlightMessengerSharedMediaViewer20=function(u,v,w,x){return c("React").createElement(c("BootloadedComponent.react"),{bootloadLoader:c("JSResource")("SpotlightViewerSphericalPhoto.react").__setRef("SpotlightMessengerSharedMediaViewer.react"),bootloadPlaceholder:c("React").createElement("div",null),height:x.y,width:x.x,fbid:u,thumbnail:v.uri,photoEncodings:w,stageDimensions:this.state.stageDimensions})};t.prototype.$SpotlightMessengerSharedMediaViewer19=function(u,v){var w=null,x=c("PhotoUtils").getImagesFromData(u);x=x.sort(function(z,A){return A.width-z.width});if(window.devicePixelRatio&&window.devicePixelRatio>1)v=new(c("Vector"))(v.x*window.devicePixelRatio,v.y*window.devicePixelRatio);for(var y=0;y<x.length;y++)if(!w||x[y].width>=v.x||x[y].height>=v.y)w=x[y];return w};t.propTypes={disableForward:o.bool,hasPrevPage:o.bool,hasNextPage:o.bool,onClosePhotoView:o.func,openAlbum:o.func,photoID:o.string,rootClassName:o.string,threadID:o.string,sharedMedia:o.arrayOf(o.object)};t.getImageDimensionsForStage=function(u,v){__p&&__p();var w=u.x,x=u.y,y=v.x,z=v.y,A=w/x,B=y/z;if(w>=y||x>=z)if(B<A){w=y;x=Math.round(y/A)}else if(B>A){w=Math.round(z*A);x=z}else{w=y;x=z}else if(A<B)w=Math.round(x*A);else x=Math.round(w/A);return new(c("Vector"))(w,x)};f.exports=t}),null);