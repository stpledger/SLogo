if (self.CavalryLogger) { CavalryLogger.start_js(["HejXk"]); }

__d("MessengerConversation.react",["csx","cx","fbt","Bootloader","BootloadOnRender.react","ChatTypingIndicators.react","CSS","DOM","DOMDimensions","Event","EventProfiler","immutable","ImmutableObject","JSReliabilityFixesGatingConfig","JSResource","KeyEventController","LazyComponent.react","MercuryActionType","MercuryIDs","MercuryRoger.bs","MercuryShareAttachmentRenderLocations","MessageList.react","MessengerAttachmentRenderer","MessengerButtonReact.bs","MessengerCollapsedLogMessageGroup.react","MessengerContextBannerContainer.react","MessengerConfig","MessengerDateBreak.react","MessengerDeliveryReceipt.bs","MessengerFlexScrollableArea.react","MessengerBootloadedLogMessage.react","MessengerMessageGroup.react","MessengerNewMessagesNoticeReact.bs","MessengerPlatformSubscriptionMessageClassification","MessengerQuickCamButtonHTML5.react","MessengerQuickCamOrigins","MessengerSpinner.react","MessengerTypingIndicator.react","MessengerVideoAutoplayActions","MessengerVideoAutoplayStore","MessengerViewerContactMethodsWebGraphQLQuery","Parent","React","ReactDOM","Set","SubscriptionsHandler","UserActivity","WebGraphQL","WebMessengerConstants","convertMIGColorToFIGColor","getPageIDFromThreadID","gkx","idx","ifRequired","joinClasses","setImmediate","throttle"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("MercuryRoger.bs").get(),n=c("MessengerButtonReact.bs").jsComponent,o=c("MessengerNewMessagesNoticeReact.bs").jsComponent,p=c("immutable").OrderedMap,q=c("React").PropTypes,r=20,s=100,t=1e3;function u(event,y){return!!(c("KeyEventController").filterEventTypes(event,y)&&c("KeyEventController").filterEventModifiers(event,y)&&event.target instanceof Element&&c("Parent").bySelector(event.target,"._4_j4"))}k=babelHelpers.inherits(v,c("React").PureComponent);l=k&&k.prototype;function v(){__p&&__p();var y,z;for(var A=arguments.length,B=Array(A),C=0;C<A;C++)B[C]=arguments[C];return z=(y=l.constructor).call.apply(y,[this].concat(B)),this.state={readReceipts:w(this.props),scrollingToUnreadMessage:false,showUnreadNotice:false,unreadCount:this.props.thread?this.props.thread.unread_count:0,width:0,viewerEmail:null,viewerPhone:null},this.$MessengerConversation1=null,this.$MessengerConversation2=0,this.$MessengerConversation3=0,this.$MessengerConversation4=null,this.$MessengerConversation6=[],this.$MessengerConversation16=function(){__p&&__p();var D=this.$MessengerConversation18();if(!this.refs||!D||this.props.isLoading){this.$MessengerConversation6=[];return}var E=c("getPageIDFromThreadID")(this.props.threadID),F=this.refs.messageList;if(!F||!E){this.$MessengerConversation6=[];return}var G=10,H=D.getElement().getBoundingClientRect(),I=[];this.$MessengerConversation5.forEach(function(J){__p&&__p();var K=J.message_id,L=this.refs.messageList.getMessageElement(K);if(L){var M=L.getBoundingClientRect();if(M.top>H.top-G&&M.bottom<H.bottom+G){I.push(K);if(!this.$MessengerConversation6.includes(K))c("Bootloader").loadModules(["MessengerAdsWebLogger","MNAdsLoggerEventEnum"],function(N,O){N.log(J.ad_client_token,J.ad_id,O.MESSAGE_SEEN_THREAD,true,K,E)},"MessengerConversation.react")}}}.bind(this),this);this.$MessengerConversation6=I}.bind(this),this.$MessengerConversation9=function(){var D=this.$MessengerConversation18();D&&D.pageUp();return false}.bind(this),this.$MessengerConversation10=function(){var D=this.$MessengerConversation18();D&&D.pageDown();return false}.bind(this),this.$MessengerConversation11=function(D){if(D.target===document.body){this.scrollToTop();return false}return null}.bind(this),this.$MessengerConversation12=function(D){if(D.target===document.body){this.scrollToBottom();return false}return null}.bind(this),this.$MessengerConversation15=function(){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(!this.refs.scrollable)return;var D=this.$MessengerConversation18(),E=this.refs.quickReply;E&&c("CSS").conditionClass(E,"_1mzg",!this.isScrolledToBottom());this.$MessengerConversation13();this.$MessengerConversation14();if(D&&this.state.unreadCount&&this.$MessengerConversation22(D))this.setState({showUnreadNotice:false,unreadCount:0});this.$MessengerConversation32(D);this.$MessengerConversation33(D);this.$MessengerConversation8()}.bind(this),this.$MessengerConversation31=function(D){D.preventDefault();this.setState({showUnreadNotice:false});this.$MessengerConversation20()}.bind(this),this.$MessengerConversation14=function(){__p&&__p();if(!this.isScrolledToBottom()||this.props.messages.size===0)return;if(c("UserActivity").isOnTab()&&c("UserActivity").isActive())this.props.onRead(this.props.threadID);else if(!this.$MessengerConversation4)this.$MessengerConversation4=c("UserActivity").subscribe(function(){if(c("UserActivity").isOnTab()){this.$MessengerConversation17();this.props.onRead(this.props.threadID)}}.bind(this))}.bind(this),this.handleResize=function(){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(this.refs.scrollable){this.refs.scrollable.handleResize();var D=c("DOMDimensions").getElementDimensions(c("ReactDOM").findDOMNode(this.refs.scrollable)).width;if(D!==this.state.width)this.setState({width:D})}var E=this.refs.quickReply;E&&c("CSS").conditionClass(E,"_1mzg",!this.isScrolledToBottom());this.trackBottomIfRequired()}.bind(this),z}v.prototype.componentDidMount=function(){__p&&__p();var y=new(c("SubscriptionsHandler"))();y.addSubscriptions(c("Event").listen(window,"resize",c("throttle")(this.handleResize,50)),c("KeyEventController").registerKey("PAGE_UP",this.$MessengerConversation9,u),c("KeyEventController").registerKey("PAGE_DOWN",this.$MessengerConversation10,u),c("KeyEventController").registerKey("HOME",this.$MessengerConversation11,u),c("KeyEventController").registerKey("END",this.$MessengerConversation12,u),m.subscribe("change",function(z,A){A[this.props.threadID]&&this.setState({readReceipts:w(this.props)})}.bind(this)));this.$MessengerConversation1=y;this.$MessengerConversation13();this.handleResize();this.$MessengerConversation14();this.$MessengerConversation7=c("throttle")(this.$MessengerConversation15,s);this.$MessengerConversation8=c("throttle")(this.$MessengerConversation16,t);this.$MessengerConversation5=this.props.messages.filter(function(z){return z.is_sponsored});this.$MessengerConversation8()};v.prototype.componentWillReceiveProps=function(y){__p&&__p();var z=y.threadID!==this.props.threadID;if(z){this.$MessengerConversation17();this.setState({scrollingToUnreadMessage:false,showUnreadNotice:false,unreadCount:y.thread?y.thread.unread_count:0})}if(z||y.messages!==this.props.messages){this.$MessengerConversation5=y.messages.filter(function(A){return A.is_sponsored});this.setState({readReceipts:w(y)})}};v.prototype.componentWillUnmount=function(){this.$MessengerConversation17();this.$MessengerConversation1&&this.$MessengerConversation1.release()};v.prototype.componentWillUpdate=function(){var y=this.$MessengerConversation18();if(y){this.$MessengerConversation2=y.getScrollHeight();this.$MessengerConversation3=y.getScrollTop()}};v.prototype.componentDidUpdate=function(y){__p&&__p();if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;if(!this.refs.scrollable)return;var z=this.props.threadID!==y.threadID;if(z||x(y,this.props)){this.scrollToBottom();this.$MessengerConversation19()}else{var A=this.$MessengerConversation18();if(A){var B=A.getScrollHeight();if(B!==this.$MessengerConversation2){var C=A.getScrollHeight()-this.$MessengerConversation2+this.$MessengerConversation3;this.refs.scrollable.scrollToPosition(C)}else this.$MessengerConversation19()}}if(this.props.messages!==y.messages){this.$MessengerConversation14();if(this.state.scrollingToUnreadMessage)this.$MessengerConversation20();this.$MessengerConversation21()}setTimeout(function(){var F=this.$MessengerConversation18();this.trackBottomIfRequired();if(F&&this.state.unreadCount&&!this.state.scrollingToUnreadMessage&&!this.props.isLoading)if(this.$MessengerConversation22(F))this.setState({showUnreadNotice:false,unreadCount:0});else this.setState({showUnreadNotice:true});this.$MessengerConversation13();this.$MessengerConversation8()}.bind(this),0);var D=y.messages&&y.messages.size||0,E=this.props.messages&&this.props.messages.size||0;if(z||D===0&&(E>0||!this.props.isLoading))c("EventProfiler").informManualInteractionTimestamp(["MessengerThredRow"],true,"click")};v.prototype.render=function(){__p&&__p();if(this.props.isLoading&&this.props.messages.isEmpty())return this.$MessengerConversation23();var y=this.props.messages.last(),z=c("MercuryIDs").getParticipantIDFromUserID(this.props.viewer),A=this.$MessengerConversation24(y),B=this.$MessengerConversation25(y);this.$MessengerConversation26(y);var C=y&&y.author!==z?A||B:null,D=null;if(Array.isArray(C)){var E=C.every(function(N){return N.content_type==="user_email"&&this.state.viewerEmail===null||N.content_type==="user_phone_number"&&this.state.viewerPhone===null}.bind(this));if(!E)D=c("React").createElement(c("BootloadOnRender.react"),{component:c("React").createElement(c("LazyComponent.react"),{options:C,threadID:y.thread_id,onVoiceClipCreate:this.props.onVoiceClipCreate,viewer:this.props.viewer,quickCamOriginLocation:c("MessengerQuickCamOrigins").MESSENGER,messageId:y.message_id,pageId:c("MercuryIDs").getUserIDFromParticipantID(y.author),isMessengerAdPreview:this.props.isMessengerAdPreview,isSponsored:y.is_sponsored,viewerEmail:this.state.viewerEmail,viewerPhone:this.state.viewerPhone}),loader:c("JSResource")("MessengerBotsQuickReplyButtonList.react").__setRef("MessengerConversation.react"),placeholder:c("React").createElement("div",null)})}var F=null;if(y&&y.message_source&&y.author!==z&&c("gkx")("AT7Fdvvof3gB21NGh8Fo7o5af68El03cTnUDtqQrI_yHQbziWN3MyQvvj6iMavHBZ0fTg3S3rpHTM9337zgjjUnM")){var G=y.message_source;if(G==="camera"){var H=this.props.thread?c("convertMIGColorToFIGColor")(this.props.thread.custom_color):null,I=c("React").createElement("div",{className:"_1gc5",style:H&&{color:H}},j._("Send a photo reply"));F=c("React").createElement("div",{className:"_1gc6"},c("React").createElement(c("MessengerQuickCamButtonHTML5.react"),{className:"_4rv5 _1gcb",location:c("MessengerQuickCamOrigins").MESSENGER,threadID:this.props.threadID,viewer:this.props.viewer,textChild:I}))}}var J=null,K=null;if(F||D){J=c("React").createElement("div",{className:"_51op"},c("React").createElement("div",{className:"_51oq",onResize:this.handleResize}));K=c("React").createElement("div",{ref:"quickReply"},c("React").createElement("div",{className:"_1mzb",onResize:this.handleResize},F,D))}var L=j._("Messages"),M=j._("Load more...");return c("React").createElement(c("MessengerFlexScrollableArea.react"),{className:this.props.className,flexChildren:this.$MessengerConversation27(),footerChildren:K,onMount:function(){return c("setImmediate")(this.$MessengerConversation14)}.bind(this),onScroll:this.props.useManualFetch?undefined:this.$MessengerConversation7,ref:"scrollable",shouldStickToBottom:true,tabIndex:0,useScrollProtection:!c("gkx")("AT7X8zD-9DNn0OeQ0S5-rozrySawyX8ZP8Z_NFsQBL8WAUNZhO-HKIM8cWBdfNilWyfk5H-Q_oFDDxJhsL4ycAkk")&&c("MessengerConfig").ChatScrollInterval},c("React").createElement("div",{"aria-label":L,className:c("joinClasses")("__i_",this.props.innerClassName),role:"region"},c("React").createElement("h3",{className:"accessible_elem"},L),this.$MessengerConversation28(),this.props.useManualFetch&&!this.props.upExhausted?c("React").createElement(n,{className:"_41jf",label:M,onClick:function(){return this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_UP)}.bind(this),type:"primary",use:"default"}):null,this.$MessengerConversation29(),c("React").createElement(c("MessageList.react"),{DateBreak:c("MessengerDateBreak.react"),deliveryTimestamp:this.props.deliveryReceipts?c("MessengerDeliveryReceipt.bs").getDeliveryTimeOfThread(this.props.deliveryReceipts,this.props.threadID):0,isCanonical:this.props.isCanonical,LogMessage:c("MessengerBootloadedLogMessage.react"),CollapsedLogMessageGroup:c("MessengerCollapsedLogMessageGroup.react"),MessageGroup:c("MessengerMessageGroup.react"),messages:this.props.messages,onAttachmentLoad:this.$MessengerConversation30(this.props.threadID),readReceipts:this.state.readReceipts,ref:"messageList",location:c("MercuryShareAttachmentRenderLocations").MESSENGER,viewer:this.props.viewer,thread:this.props.thread}),this.props.useManualFetch&&!this.props.downExhausted?c("React").createElement(n,{className:"_41jf",label:M,onClick:function(){return this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_DOWN)}.bind(this),type:"primary",use:"default"}):null,c("React").createElement(c("ChatTypingIndicators.react"),{indicatorClass:c("MessengerTypingIndicator.react"),indicatorsDidShow:function(){this.trackBottomIfRequired()}.bind(this),rootClassName:"clearfix _17pz",threadID:this.props.threadID,viewer:this.props.viewer}),J))};v.prototype.$MessengerConversation24=function(y){var z=null,A=y&&y.platform_xmd&&JSON.parse(y.platform_xmd),B=A&&A.message_classification===c("MessengerPlatformSubscriptionMessageClassification").AD_MESSAGE;if(B&&Array.isArray(A&&A.quick_replies))z=A&&A.quick_replies;return z};v.prototype.$MessengerConversation25=function(y){var z=y&&y.platform_xmd&&JSON.parse(y.platform_xmd);return Array.isArray(z&&z.quick_replies)?z&&z.quick_replies:null};v.prototype.$MessengerConversation13=function(){if(this.props.useManualFetch)return;var y=this.$MessengerConversation18();if(y&&y.getScrollTop()<r){this.props.fetchMessages(c("WebMessengerConstants").MORE_SEARCH_CONTEXT_UP);this.$MessengerConversation21()}};v.prototype.$MessengerConversation26=function(y){__p&&__p();var z=this.$MessengerConversation25(y);if(!z)return;var A=c("gkx")("AT6b68OqbLsWJQlJTGZqwlCTZJ0z0taRGUXqOzuQVRDoLPO2Dnjh-maTANaNF_FUgpVzi4qt9-S_T7GMqZpzzd99"),B=c("gkx")("AT70ApPO8u4r9N24CdWkIiFYZMdcnAaeV9BaXzLxdBmkmVf60X7teW8bfJTrYYnPlB7TPT4_aBOsOQDbCdO-mpJj4JY2rmmLkTH2jaDU2xAiSg");if(z.some(function(C){return C.content_type==="user_email"&&A||C.content_type==="user_phone_number"&&B}))c("WebGraphQL").exec(new(c("MessengerViewerContactMethodsWebGraphQLQuery"))({})).done(function(C){var D,E,F,G,H=B?(D=C)!=null?(D=D.viewer)!=null?(D=D.user)!=null?D.all_phones:D:D:D:null,I=A?(E=C)!=null?(E=E.viewer)!=null?E.all_emails:E:E:null,J=!H?null:H.find(function(L){return L.is_preferred});if(!J&&H)J=H[0];var K=!I?null:I.find(function(L){return L.is_primary});this.setState({viewerEmail:(F=K)!=null?(F=F.email_address)!=null?F.deduplicated_email_address:F:F,viewerPhone:(G=J)!=null?(G=G.phone_number)!=null?G.universal_number:G:G})}.bind(this))};v.prototype.isScrolledToBottom=function(){return!!(this.refs.scrollable&&this.refs.scrollable.isScrolledToBottom())};v.prototype.isScrolledToBottomWithHeight=function(y){return!!(this.refs.scrollable&&this.refs.scrollable.isScrolledToBottomWithHeight(y))};v.prototype.$MessengerConversation27=function(){return c("React").createElement(o,{isOpen:this.state.showUnreadNotice,label:j._({"*":"{number} unread messages","_1":"1 unread message"},[j.plural(this.state.unreadCount,"number")]),onClick:this.$MessengerConversation31})};v.prototype.$MessengerConversation28=function(){if(!this.props.isLoaded)return null;return c("React").createElement(c("MessengerContextBannerContainer.react"),{location:c("MercuryShareAttachmentRenderLocations").MESSENGER,threadID:this.props.threadID,viewer:this.props.viewer})};v.prototype.$MessengerConversation29=function(){if(this.props.isLoaded)return null;return c("React").createElement("div",{className:"_2k8v"},this.props.isLoading?c("React").createElement(c("MessengerSpinner.react"),null):null)};v.prototype.$MessengerConversation23=function(){return c("React").createElement("div",{className:"_4xu0"},c("React").createElement(c("MessengerSpinner.react"),{className:"_4xu1",size:c("MessengerSpinner.react").large_size}))};v.prototype.trackBottomIfRequired=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.trackBottomIfRequired()};v.prototype.scrollToBottom=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.scrollToBottom()};v.prototype.scrollToTop=function(y){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;this.refs.scrollable&&this.refs.scrollable.scrollToTop(y)};v.prototype.$MessengerConversation30=function(y){return function(){if(this.props.threadID!==y)return;this.trackBottomIfRequired()}.bind(this)};v.prototype.$MessengerConversation19=function(){c("DOM").scry(c("ReactDOM").findDOMNode(this),"img").forEach(function(y){if(y.complete)return;var z=this.props.threadID,A=c("Event").listen(y,"load",function(){if(this.props.threadID===z)this.trackBottomIfRequired();A.remove()}.bind(this))}.bind(this))};v.prototype.$MessengerConversation34=function(){var y=this.props.messages,z=this.state.unreadCount;if(!z||z>y.size)return null;return y.get(y.size-z)};v.prototype.$MessengerConversation22=function(y){__p&&__p();var z=this.props.messages,A=this.$MessengerConversation34();if(!A)return false;var B=y.getElement().getBoundingClientRect();return z.filter(function(C){return C.timestamp<=A.timestamp}).some(function(C){var D=this.refs.messageList.getMessageElement(C.message_id);if(!D)return false;var E=D.getBoundingClientRect();return E.bottom>B.top&&E.top<B.bottom}.bind(this))};v.prototype.$MessengerConversation35=function(y){return!!this.props.messages.find(function(z){return z.message_id===y})};v.prototype.$MessengerConversation20=function(){__p&&__p();if(!this.state.unreadCount)return;this.setState({scrollingToUnreadMessage:true});var y=this.$MessengerConversation34();if(!y){this.scrollToTop(false);return}this.$MessengerConversation36(y.message_id,function(){this.setState({scrollingToUnreadMessage:false,unreadCount:0})}.bind(this))};v.prototype.$MessengerConversation36=function(y,z){var A=this.refs.messageList.getMessageElement(y,true),B=this.$MessengerConversation18();if(!A||!B)return;var C=A.getBoundingClientRect().top,D=c("ReactDOM").findDOMNode(this.refs.messageList).getBoundingClientRect().top,E=B.getElement().getBoundingClientRect().top,F=C+Math.abs(D)+E;B.setScrollTop(F,true,{callback:z})};v.prototype.$MessengerConversation18=function(){if(c("JSReliabilityFixesGatingConfig").should_get_fix&&!this.refs)return;return this.refs.scrollable&&this.refs.scrollable.getArea()};v.prototype.$MessengerConversation17=function(){this.$MessengerConversation4&&this.$MessengerConversation4.unsubscribe();this.$MessengerConversation4=null};v.prototype.$MessengerConversation37=function(){return this.props.messages.filter(function(y){return c("MessengerAttachmentRenderer").isSingleVideoAttachment(y)||c("MessengerAttachmentRenderer").isSharedVideoAttachmentMessage(y)}).reverse().map(function(y){return y.message_id})};v.prototype.$MessengerConversation32=function(y){__p&&__p();var z=this.refs.messageList;if(!z||!y)return;var A=[],B=y.getElement().getBoundingClientRect(),C=c("MessengerVideoAutoplayStore").getMessageIDs(this.props.threadID),D=C||this.$MessengerConversation37()||c("immutable").List();D.map(function(E){var F=c("MessengerAttachmentRenderer").getVideoElem(E,z);if(F)A.push([E,F.getBoundingClientRect()])});if(A.length)c("MessengerVideoAutoplayActions").onScroll(this.props.threadID,C?null:D,c("immutable").Map(A),B)};v.prototype.$MessengerConversation38=function(){return this.props.messages.filter(function(y){return c("MessengerAttachmentRenderer").isSingleSphericalPhotoAttachment(y)}).map(function(y){return y.message_id})};v.prototype.$MessengerConversation33=function(y){__p&&__p();c("ifRequired")("MessengerSphericalRendererActions",function(z){__p&&__p();c("ifRequired")("MessengerSphericalRendererStore",function(A){__p&&__p();var B=this.refs.messageList;if(!B||!y)return;var C=[],D=y.getElement().getBoundingClientRect(),E=A.getMessageIDs(this.props.threadID),F=E||this.$MessengerConversation38()||c("immutable").List();F.map(function(G){var H=c("MessengerAttachmentRenderer").getSphericalPhotoElem(G,B);if(H)C.push([G,H.getBoundingClientRect()])});if(C.length)z.onScroll(this.props.threadID,F,c("immutable").Map(C),D)}.bind(this),function(){})}.bind(this),function(){})};v.prototype.$MessengerConversation21=function(){c("MessengerVideoAutoplayActions").updateStore(this.props.threadID,this.$MessengerConversation37());var y=this.$MessengerConversation38();if(y&&y.count()!==0)c("ifRequired")("MessengerSphericalRendererActions",function(z){z.updateStore(this.props.threadID,y)}.bind(this),function(){c("Bootloader").loadModules(["MessengerSphericalRendererActions","MessengerSphericalRendererStore"],function(z,A){z.updateStore(this.props.threadID,y)}.bind(this),"MessengerConversation.react")}.bind(this))};v.propTypes={contact:q.instanceOf(c("ImmutableObject")),deliveryReceipts:q.object,downExhausted:q.bool,fetchMessages:q.func.isRequired,innerClassName:q.string,isCanonical:q.bool,isLoaded:q.bool,isLoading:q.bool,isMessengerAdPreview:q.bool,messages:q.instanceOf(c("immutable").List).isRequired,onVoiceClipCreate:q.func,participants:q.instanceOf(c("immutable").Map),thread:q.object,threadID:q.string.isRequired,upExhausted:q.bool,useManualFetch:q.bool,viewer:q.string.isRequired};function w(y){__p&&__p();var z=c("MercuryIDs").getParticipantIDFromUserID(y.viewer),A=m.getSeenTimestamps(y.threadID),B=new(c("Set"))(y.thread?y.thread.participants:A.keys());B["delete"](z);var C=null;c("immutable").Seq(y.messages).reverse().forEach(function(D){if(D.action_type!==c("MercuryActionType").LOG_MESSAGE){C=D;return false}return true});return A.withMutations(function(A){__p&&__p();c("immutable").Seq(y.messages).reverse().forEach(function(D){__p&&__p();if(B.size===0)return false;if(!B.has(D.author))return;A.update(D.author,function(E){var F=E;if(!E||E.watermark<=D.timestamp)F={watermark:D.timestamp,action:D.timestamp};if(C&&C.timestamp<F.watermark)F={watermark:C.timestamp,action:C.timestamp};return F});B["delete"](D.author)})})}function x(y,z){var A=c("MercuryIDs").getParticipantIDFromUserID(z.viewer);return z.threadID===y.threadID&&z.messages!==y.messages&&!z.messages.isEmpty()&&z.messages.last()!==y.messages.last()&&z.messages.last().author===A}f.exports=v}),null);