if (self.CavalryLogger) { CavalryLogger.start_js(["1l1aE"]); }

__d("FBRTCCallabilityActions",["keyMirror"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();var h=c("keyMirror")({CALLABILITY_FETCHED:null,CALLABILITY_FETCH_ERROR:null});function i(j){this.$FBRTCCallabilityActions1=j}i.prototype.callabilityFetched=function(j,k){this.$FBRTCCallabilityActions1.dispatch({type:h.CALLABILITY_FETCHED,userID:j,callability:k})};i.prototype.callabilityFetchError=function(j){this.$FBRTCCallabilityActions1.dispatch({type:h.CALLABILITY_FETCH_ERROR,userID:j})};i.Types=h;f.exports=i}),null);
__d("XRTCCallabilityController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("/rtc/callability/",{user_id:{type:"FBID",required:true}})}),null);
__d("FBRTCCallabilityDataManager",["AsyncRequest","FBRTCCallabilityActions","TimeSlice","XRTCCallabilityController"],(function a(b,c,d,e,f,g){"use strict";__p&&__p();function h(i){this.$FBRTCCallabilityDataManager1=new(c("FBRTCCallabilityActions"))(i)}h.prototype.fetchCallability=function(i){c("TimeSlice").guard(function(){var j=c("XRTCCallabilityController").getURIBuilder().setFBID("user_id",i).getURI(),k=this.$FBRTCCallabilityDataManager2.bind(this,i),l=this.$FBRTCCallabilityDataManager3.bind(this,i);new(c("AsyncRequest"))().setURI(j).setHandler(k).setErrorHandler(l).setAllowCrossPageTransition(true).send()}.bind(this),"Chat Tab RTC Callability Check",{propagationType:c("TimeSlice").PropagationType.ORPHAN})()};h.prototype.$FBRTCCallabilityDataManager2=function(i,j){this.$FBRTCCallabilityDataManager1.callabilityFetched(i,j.payload)};h.prototype.$FBRTCCallabilityDataManager3=function(i,j){this.$FBRTCCallabilityDataManager1.callabilityFetchError(i)};f.exports=h}),null);
__d("RTCCallabilityStore",["fbt","Cache","FBRTCCallabilityActions","FBRTCCallabilityDataManager","FluxStore","MercuryThreadInfo","RTCConfig"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i,j,k=.5,l=5;i=babelHelpers.inherits(m,c("FluxStore"));j=i&&i.prototype;function m(n){j.constructor.call(this,n);this.$RTCCallabilityStore2=new(c("FBRTCCallabilityDataManager"))(n);this.$RTCCallabilityStore1=new(c("Cache"))()}m.prototype.__onDispatch=function(n){var o=n.type;switch(o){case c("FBRTCCallabilityActions").Types.CALLABILITY_FETCHED:var p=n.userID,q=n.callability;this.$RTCCallabilityStore1.set(p,{callable:q.is_callable,isBlocked:q.is_blocked},null,q.is_callable?l:k);this.__emitChange();break;case c("FBRTCCallabilityActions").Types.CALLABILITY_FETCH_ERROR:this.$RTCCallabilityStore1.set(n.userID,{callable:false,isBlocked:false},null,k);this.__emitChange();break}};m.prototype.isCallable=function(n,o){var p=o?o.message_count>0&&o.folder==="inbox":false,q=this.fetchUserFromCache(n);return q&&q.callable||p};m.prototype.isBlocked=function(n,o){var p=o?c("MercuryThreadInfo").canReply(o):true,q=this.fetchUserFromCache(n);return q&&q.isBlocked||!p};m.prototype.fetchUserFromCache=function(n){if(!this.$RTCCallabilityStore1.has(n)){this.$RTCCallabilityStore2.fetchCallability(n);this.$RTCCallabilityStore1.set(n,{callable:false,isBlocked:false},null,k)}return this.$RTCCallabilityStore1.get(n)};m.prototype.callButtonTooltip=function(n,o){var p=arguments.length<=2||arguments[2]===undefined?true:arguments[2],q=arguments[3];if(!this.isBlocked(n,q)&&(p||this.isCallable(n)))return h._("Start a video chat with {shortname}",[h.param("shortname",o)]);return h._("{shortname} is currently unavailable for video calling",[h.param("shortname",o)])};m.prototype.voiceCallButtonTooltip=function(n,o){var p=arguments.length<=2||arguments[2]===undefined?true:arguments[2],q=arguments[3];if(!this.isBlocked(n,q)&&(p||this.isCallable(n)))return h._("Start a voice call with {shortname}",[h.param("shortname",o)]);return h._("{shortname} is currently unavailable for voice calling",[h.param("shortname",o)])};f.exports=m}),null);
__d("MNRTCCallabilityStore",["MessengerDispatcher","RTCCallabilityStore"],(function a(b,c,d,e,f,g){"use strict";f.exports=new(c("RTCCallabilityStore"))(c("MessengerDispatcher"))}),null);
__d("MercuryRTCShareAttachment.react",["cx","ix","fbt","FBRTCCore","FBRTCLogger","FBRTCSupport","Image.react","React","MercuryLogMessageType","MercuryShareAttachmentReactShape","MercuryShareAttachmentRenderLocations","MercuryViewer","MercuryParticipants","MercuryIDs","MercuryTimestamp","MessengerTextWithEmoticons.react","MessengerRTCFunnelLogger","MNRTCCallabilityStore","ShimButton.react","SimpleXUIDialog","XUIText.react","XUIButton.react","CenteredContainer.react"],(function a(b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();var k,l,m=c("MercuryShareAttachmentRenderLocations").CHAT,n=c("MercuryShareAttachmentRenderLocations").MESSENGER;k=babelHelpers.inherits(o,c("React").PureComponent);l=k&&k.prototype;function o(){var p,q;for(var r=arguments.length,s=Array(r),t=0;t<r;t++)s[t]=arguments[t];return q=(p=l.constructor).call.apply(p,[this].concat(s)),this.state={peerName:"",peerType:""},q}o.prototype.componentDidMount=function(){var p=this.props.attachment.log_message_data.caller,q=this.props.attachment.log_message_data.callee,r=p===c("MercuryViewer").getID(),s=r?q:p;c("MercuryParticipants").get(s,function(t){this.setState({peerName:t.short_name?t.short_name:t.name,peerType:t.type?t.type:""})}.bind(this))};o.prototype.render=function(){__p&&__p();var p=this.props.attachment,q=p.log_message_data,r=p.log_message_body,s=q.caller,t=q.callee,u=q.answered,v=s===c("MercuryViewer").getID(),w=v?t:s,x=c("MercuryIDs").getUserIDFromParticipantID(w),y=this.state.peerName,z=this.state.peerType==="page",A=c("MercuryTimestamp").getPreciseTimestamp(this.props.attachment.timestamp),B=c("React").createElement(c("MessengerTextWithEmoticons.react"),{text:r}),C=this.$MercuryRTCShareAttachment1(u,v,A),D=void 0,E=void 0;if(this.props.location===m){D=this.$MercuryRTCShareAttachment2(x,y,u,v);return c("React").createElement("div",{className:"_1k2i"},c("React").createElement("div",{className:!u&&!v?"_1k2j":""},c("React").createElement(c("XUIText.react"),{weight:"bold"},B),c("React").createElement(c("XUIText.react"),{weight:"bold"},C)),z?null:c("React").createElement(c("React").Fragment,null,c("React").createElement("hr",null),c("React").createElement(c("CenteredContainer.react"),{vertical:true,className:"_3-8x"},D)))}else if(this.props.location===n){D=this.$MercuryRTCShareAttachment2(x,y,u,v);return c("React").createElement("div",{className:"_55q _5i_d _52mr"},c("React").createElement("div",{className:(!u&&!v?"_1k2j":"")+(!z?" _55r":"")},c("React").createElement(c("XUIText.react"),{weight:"bold"},B),c("React").createElement(c("XUIText.react"),{weight:"bold"},C)),z?null:c("React").createElement(c("CenteredContainer.react"),{vertical:true,className:"_3-8w"},D))}E=this.$MercuryRTCShareAttachment3(x,y,u,v);return c("React").createElement("div",null,c("React").createElement("div",{className:(!u&&!v?"_1k2j":"")+" _55s"},B),z?null:c("React").createElement("div",{className:"_55t"},E))};o.prototype.$MercuryRTCShareAttachment1=function(p,q,r){var s=null;if(!p&&!q)s=i("86815");else if(q)s=i("86816");else s=i("86813");return c("React").createElement("div",{className:"_2phz"},c("React").createElement(c("Image.react"),{src:s}),c("React").createElement("span",{className:(p||q?"_3ole":"")+" _2pir"},r))};o.prototype.$MercuryRTCShareAttachment2=function(p,q,r,s){if(c("FBRTCSupport").isOSSupported())return c("React").createElement(c("ShimButton.react"),{form:"link",onClick:this.$MercuryRTCShareAttachment4.bind(this,p,q)},!r&&!s?j._("Call Back"):j._("Call Again"));else return c("React").createElement("span",null,!r&&!s?j._("Call Back"):j._("Call Again"))};o.prototype.$MercuryRTCShareAttachment3=function(p,q,r,s){var t=!r&&!s?j._("Call Back"):j._("Call Again");return c("React").createElement(c("XUIButton.react"),{onClick:this.$MercuryRTCShareAttachment4.bind(this,p,q),label:t})};o.prototype.$MercuryRTCShareAttachment4=function(p,q){if(!p)return;var r=this.props.attachment.log_message_type===c("MercuryLogMessageType").PHONE_CALL;c("MessengerRTCFunnelLogger").startFunnel("Attachment");if(c("FBRTCCore").isAvailableForWebrtcCalling(p)||c("MNRTCCallabilityStore").isCallable(p))c("FBRTCCore").startOutgoingCall(p,c("FBRTCLogger").Trigger.ADMIN_MESSAGE,r);else c("SimpleXUIDialog").show(j._("{firstname} can't be reached right now.",[j.param("firstname",q)]),j._("Can't Connect Call"))};f.exports=o}),null);