if (self.CavalryLogger) { CavalryLogger.start_js(["x5g8\/"]); }

__d("MercurySyncDataFetcherImpl",["errorCode","Promise","AsyncResponse","Bootloader","CurrentUser","FBIDCheck","MercuryPayloadSource","MercuryThreadlistConstants","MessagingConfig","UserActivity","setTimeoutAcrossTransitions"],(function a(b,c,d,e,f,g,h){"use strict";__p&&__p();var i=c("MessagingConfig").syncFetchRequestTimeoutMs,j={limit:c("MercuryThreadlistConstants").WEBMESSENGER_THREAD_COUNT+1,folder:"inbox",tags:["INBOX"],timestamp:null,offset:c("MercuryThreadlistConstants").RECENT_THREAD_OFFSET,filter:null,includeDeliveryReceipts:false,includeSeqID:true},k={};function l(r){return new(c("Promise"))(function(s,t){m(r,s,t,0)})}function m(r,s,t,u){__p&&__p();if(!c("CurrentUser").isLoggedInNow()||u>c("MessagingConfig").syncFetchRetries){clearTimeout(k[r]);t();return}var v=u===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,u);if(!c("UserActivity").isOnTab())v+=500*Math.random();clearTimeout(k[r]);k[r]=c("setTimeoutAcrossTransitions")(function(){__p&&__p();var w=false,x=function x(y){__p&&__p();var z;if(w)return;if(y.errors&&y.errors.length>0)(function(){var A=y.errors[0].message;if(A)c("Bootloader").loadModules(["MessengerWebGraphQLTypedLogger","MessengerWebGraphQLEvent"],function(B,C){new B().setErrorMessage(A).setEvent(C.DFF_FAILURE).setQueryParams(r).log()},"MercurySyncDataFetcherImpl")})();w=true;m(r,s,t,u+1)};c("Bootloader").loadModules(["MessengerGraphQLThreadlistFetcher.bs"],function(y){return y.fetchAll(r,[j],!c("FBIDCheck").isUser_deprecated(r)).then(function(z){w=true;s(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},z,{payload_source:c("MercuryPayloadSource").SERVER_INVALIDATE_GLOBAL_STATE})));clearTimeout(k[r])},x)},"MercurySyncDataFetcherImpl")},v)}function n(r,s,t){return new(c("Promise"))(function(u,v){o(r,s,t,u,v,0)})}function o(r,s,t,u,v,w){__p&&__p();if(w>c("MessagingConfig").syncFetchRetries){v();return}var x=w===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,w);c("setTimeoutAcrossTransitions")(function(){var y=false,z=function z(A){if(y)return;y=true;o(r,s,t,u,v,w+1)};c("Bootloader").loadModules(["MessengerThreadDFFFetcher.bs"],function(A){return A.fetch(r,{id:s,limit:t},!c("FBIDCheck").isUser_deprecated(r)).then(function(B){y=true;u(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},B,{payload_source:c("MercuryPayloadSource").SERVER_INVALIDATE_THREAD_STATE})))},z)},"MercurySyncDataFetcherImpl")},x)}function p(r,s,t){return new(c("Promise"))(function(u,v){q(r,s,t,u,v,0)})}function q(r,s,t,u,v,w){__p&&__p();if(w>c("MessagingConfig").syncFetchRetries){v();return}var x=w===0?0:c("MessagingConfig").syncFetchInitialTimeoutMs*Math.pow(c("MessagingConfig").syncFetchTimeoutMultiplier,w);c("setTimeoutAcrossTransitions")(function(){var y=false,z=function z(A){if(y)return;y=true;q(r,s,t,u,v,w+1)};c("Bootloader").loadModules(["MessengerMessageDFFFetcher.bs"],function(A){return A.fetch(r,{thread_id:s,message_id:t},!c("FBIDCheck").isUser_deprecated(r)).then(function(B){y=true;u(new(c("AsyncResponse"))(null,babelHelpers["extends"]({},B)))},z)},"MercurySyncDataFetcherImpl")},x)}f.exports={fetchThreadlistFromGraphQL:l,fetchThreadFromGraphQL:n,fetchMessageFromGraphQL:p}}),null);